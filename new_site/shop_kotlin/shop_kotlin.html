<h3 dir="auto" tabindex="-1">Оглавление:</h3>
<a></a>
<p dir="auto"><a href="#target_project">Цель</a></p>
<p dir="auto">
    <a href="#static_analize">Статический анализатор Idea Analize</a><br />
    <a href="#sonarcube">Статический анализатор SonarCube</a><br />
    <a href="#jpa_kotlin">JPA Entity классы с Kotlin</a>
</p>
<p dir="auto">
    <a href="#unit_test">Unit тестирование</a><br />
    <a href="#integration_test">Интеграционное тестирование в проекте</a><br />
    <a href="#coverage_test">Покрытие тестами</a><br />
    <a href="#spring_profiles">Spring profiles</a><br />
    <a href="#cors">CORS filter</a><br />
    <a href="#test_run">Тестовый запуск</a>
</p>
<p dir="auto">
    <a href="#bootjar">Создание запускаемого файла и его запуск</a><br />
    <a href="#publish_fat-jar">Publishing SpringBoot "FAT" jar</a>
</p>
<p dir="auto">
    <a href="#datajpa_restassured_test">Интеграционное тестирование</a><br />
    <a href="#httpie">Примеры тестов httpie</a><br />
    <a href="#datajpa_test">DataJpa tests</a><br />
    <a href="#restassured_test">RestAssured tests</a><br />
    <a href="#yandex_tank_test">Нагрузочное тестирование</a>
</p>
<p dir="auto">
    <a href="#swagger">Swagger</a><br />
    <a href="#spring_actuator">Spring Actuator</a>
</p>
<p dir="auto">
    <a href="#prometheus">Prometheus</a><br />
    <a href="#show_cpu_prometheus">Пример просмотра использования CPU в Prometheus</a><br />
    <a href="#prometheus_docker">Запуск prometheus в docker</a>
</p>
<p dir="auto">
    <a href="#docker">Docker</a><br />
    <a href="#grafana">Grafana</a><br />
    <a href="#caching">Кеширование</a><br />
    <a href="#jenkins">Сборка Jenkins</a><br />
    <a href="#nexus">Nexus</a>
</p>
<p dir="auto">
    <a href="#jmc">Просмотр ресурсов с помощью Java Mission Control</a><br />
    <a href="#logging">Логирование</a>
</p>
<p dir="auto">
    <a href="#easycode_idea">Использование "ChatGPT-EasyCode" в Idea</a><br />
    <a href="#easycode_vscode">Использование "ChatGPT-EasyCode" в VSCode</a>
</p>
<p dir="auto">
    <a href="#add_param_to_application_yaml">Частный параметр конфигурации в application.yaml</a><br />
    <a href="#set_var_application_yaml">Переопределение значения переменных application.yaml</a><br />
</p>
<p dir="auto">
    <a href="#todo">TODO</a><br />
    <a href="#tose">Примечания</a><br />
    <a href="#links">Ссылки</a>
</p>
<hr id="system-readmore" />
<a id="target_project"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-цель" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%86%D0%B5%D0%BB%D1%8C"></a>Цель</h3>
<p dir="auto">Cоздать небольшое приложение на <b>Kotlin</b> с использованием <b>Spring Boot</b>. Справочник товаров со следующими типами:</p>
<ul dir="auto">
    <li>Настольные компьютеры</li>
    <li>Ноутбуки</li>
    <li>Мониторы</li>
    <li>Жесткие диски</li>
</ul>
<p>Каждый товар имеет следующие свойства:</p>
<ul dir="auto">
    <li>номер серии</li>
    <li>производитель</li>
    <li>цена</li>
    <li>количество единиц продукции на складе</li>
</ul>
<p dir="auto">Дополнительные свойства:</p>
<ul dir="auto">
    <li>Настольные компьютеры имеют форм-фактор: десктопы, неттопы, моноблоки</li>
    <li>Ноутбуки подразделяются по размеру: 13, 14, 15, 17 дюймовые</li>
    <li>Мониторы имеют диагональ</li>
    <li>Жесткие диски имеют объем</li>
</ul>
<p>Необходимо реализовать back-end приложение, которое имеет RESTful HTTP методы выполняющие:</p>
<ul dir="auto">
    <li>Добавление товара</li>
    <li>Редактирование товара</li>
    <li>Просмотр всех существующих товаров по типу</li>
    <li>Просмотр товара по идентификатору</li>
</ul>
<p>В качестве базы данных использовать in memory database, например H2.</p>
<p dir="auto"> </p>
<a id="static_analize"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-статический-анализатор-idea-analize" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80-idea-analize"></a>Статический анализатор Idea Analize
</h3>
<p dir="auto">Проверка кода. Вызывается из контекстного меню Analize - Inspect Code.</p><a href="#top">Наверх</a>
<p dir="auto"> </p>
<a id="sonarcube"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-статический-анализатор-sonarcube" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80-sonarcube"></a>Статический анализатор SonarCube
</h3>
<p dir="auto">
    <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/sonarqube/use_sonarcube.md">https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/sonarqube/use_sonarcube.md</a>
</p>
<p dir="auto"> </p>
<a id="jpa_kotlin"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-jpa-entity-классы-с-kotlin" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#jpa-entity-%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D1%8B-%D1%81-kotlin"></a>JPA Entity классы с Kotlin
</h3>
<p dir="auto">
    Источник: <a href="https://habr.com/ru/companies/haulmont/articles/572574/" rel="nofollow">https://habr.com/ru/companies/haulmont/articles/572574/</a><br />Примеры из источника: <a href="https://github.com/Klimenkoob/spring-kotlin-hibernate">https://github.com/Klimenkoob/spring-kotlin-hibernate</a>
</p>
<p dir="auto">Рекомендации:</p>
<ol dir="auto">
    <li><strong>Data class not recommended for JPA Entity</strong> . Warning in Idea. Почему не использовать Data-классы? Потому что они финальны сами по себе, имеют по всем полям определенные equals, hashCode и toString. А это недопустимо в связке с Hibernate.</li>
    <li>Явно помечать ключевым словом <strong>open</strong> все Entity. Согласно спецификации JPA, все классы и свойства, связанные с JPA, не должны быть <strong>final</strong>. В отличие от Java, в Kotlin классы, свойства и методы по умолчанию final. Поэтому их нужно явно помечать ключевым словом <strong>open</strong>.</li>
    <li><strong>Явно определять</strong> hashCode(), equals(), toString(). При определении внимание на <strong>lazy</strong> поля (как и в Java).</li>
    <li>Добавить <strong>nullable = false</strong><div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">@ManyToOne(fetch = FetchType.LAZY, optional = <span style="color: #008800; font-weight: bold">false</span>) @JoinColumn(name = <span style="background-color: #fff0f0">"client_id"</span>, nullable = <span style="color: #008800; font-weight: bold">false</span>)
lateinit <span style="color: #008800; font-weight: bold">var</span> client: Client
</pre></div></li>
</ol>
<ol dir="auto" start="5">
    <li>Kotlin классы по умолчанию <strong>final</strong>. Для Entity это проблема. Можно применить plugin "allopen":
        <div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">plugins {
  kotlin(<span style="background-color: #fff0f0">"plugin.allopen"</span>)
}
...

allopen {
  annotation(<span style="background-color: #fff0f0">"javax.persistence.Entity"</span>)
}
</pre></div></li>
</ol>
<a id="unit_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-unit-тестирование" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#unit-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"></a>Unit тестирование</h3>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew <span style="color: #007020">test</span>
</pre></div>

<p dir="auto">Примеры отбора тестов:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew <span style="color: #007020">test</span> --tests <span style="background-color: #fff0f0">'*EntityTest'</span>
./gradlew <span style="color: #007020">test</span> --tests <span style="background-color: #fff0f0">'*Rest*'</span>
./gradlew <span style="color: #007020">test</span> --tests ProductDTOTest
./gradlew <span style="color: #007020">test</span> --tests <span style="background-color: #fff0f0">'*TestIntegration'</span>
./gradlew <span style="color: #007020">test</span> --tests <span style="background-color: #fff0f0">'*MockMvcTest'</span>
</pre></div>

<a id="integration_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-интеграционное-тестирование-в-проекте" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B2-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B5"></a>Интеграционное тестирование в проекте
</h3>
<p dir="auto">Вообще, интеграционные тесты должны быть в отдельном проекте (см. <a href="https://github.com/cherepakhin/shop_kotlin_restassured_test">https://github.com/cherepakhin/shop_kotlin_restassured_test</a>). В этом проекте оставил только тесты работы с базой данных. Имена интеграционных тестов должны заканчиваться ..TestIntegration. Прогнать все, кроме интеграционных (включены только *Test, исключены *TestIntegration):</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew clean <span style="color: #007020">test</span> --tests *Test
</pre></div>

<p dir="auto">Только интеграционные:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew clean <span style="color: #007020">test</span> --tests *TestIntegration*
./gradlew clean <span style="color: #007020">test</span> --tests *TestIntegration
</pre></div>
<p dir="auto">Другие примеры:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">gradle <span style="color: #007020">test</span> --tests org.gradle.SomeTest.someSpecificFeature
gradle <span style="color: #007020">test</span> --tests *SomeTest.someSpecificFeature
gradle <span style="color: #007020">test</span> --tests *SomeSpecificTest
gradle <span style="color: #007020">test</span> --tests all.in.specific.package*
gradle <span style="color: #007020">test</span> --tests *IntegTest
gradle <span style="color: #007020">test</span> --tests *IntegTest*ui*
gradle <span style="color: #007020">test</span> --tests *IntegTest.singleMethod
gradle someTestTask --tests *UiTest someOtherTestTask --tests *WebTest*ui
</pre></div>

<p dir="auto">Включено протоколирование тестов build.gradle.kts:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">...
tasks.withType<span style="color: #007700">&lt;Test&gt;</span> {
    ...
    // Show test log
    testLogging {
        events("passed", "skipped", "failed")
    }
    ...
}
</pre></div>
<p dir="auto">Вывод в консоль:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">...
ProductServiceImplMockTest > getByGroupProductN<span style="color: #333333">()</span> PASSED
ProductServiceIntegrationTest > existByN<span style="color: #333333">()</span> PASSED
ProductServiceIntegrationTest > notExistByN<span style="color: #333333">()</span> PASSED
ProductServiceIntegrationTest > checkSortByName_ByDslFilterByName<span style="color: #333333">()</span> PASSED
...
</pre></div>

<p dir="auto">с events("standardOut", "started", "passed", "skipped", "failed") логируется вывод в консоль.</p>
<p dir="auto"> </p>
<a id="coverage_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-покрытие-тестами" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D0%BE%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B0%D0%BC%D0%B8"></a>Покрытие тестами
</h3>
<p dir="auto">Использован <a href="https://www.eclemma.org/jacoco/" rel="nofollow">jacoco</a>. Отчет формируется при прогоне тестов</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew <span style="color: #007020">test </span>jacocoTestReport
</pre></div>
<p dir="auto">Отчет будет в папке build/reports/jacoco/test/html. В отчете <strong>НЕТ</strong> информации о результатах тестирования, только протестирован участок кода или нет.</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jacoco.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jacoco.png" alt="jacoco" /></a></p>
<p dir="auto">Пример отчета по конкретному классу:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jacoco_example.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jacoco_example.png" alt="jacoco_example" /></a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jacoco_class.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jacoco_class.png" alt="jacoco_class" /></a></p>
<p dir="auto">Красным или желтым выделены непротестированные участки кода, зеленым протестировано.</p>
<p dir="auto"> </p>
<a id="spring_profiles"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-spring-profiles" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#spring-profiles"></a>Spring profiles
</h3>
<p dir="auto">Настроены два Spring профиля:
    <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/src/main/resources/application-prod.yml" target="_blank" rel="noopener noreferrer"><u>application-prod.yml</u></a>
    и
    <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/src/main/resources/application-dev.yml" target="_blank" rel="noopener noreferrer"><u>application-dev.yml</u></a>.
    В этом же файле указан профиль по умолчанию:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">spring:
  profiles:
    active: dev
  application:
    name: shop_kotlin
</pre></div>
<p dir="auto">Запуск с указанием профиля:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">java -D<span style="background-color: #fff0f0">"spring.profiles.active=dev"</span> -jar app.jar
</pre></div>

<p dir="auto">или установить env переменную:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">SPRING_PROFILES_ACTIVE</span> <span style="color: #333333">=</span> dev
</pre></div>
<p dir="auto">Запуск с gradle:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew bootRun --args<span style="color: #333333">=</span><span style="background-color: #fff0f0">'--spring.profiles.active=dev'</span>
</pre></div>

<p dir="auto">или</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">SPRING_PROFILES_ACTIVE</span><span style="color: #333333">=</span>dev ./gradlew clean bootRun
</pre></div>
<a id="cors"></a>
<h3>CORS filter</h3>
При выполнении запросов может быть получена ошибка: <b>"Ошибка: "Access to XMLHttpRequest at 'http://localhost:8080/api/hello' from origin 'http://localhost:4200' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource."</b>.
Доходчиво описано в <a href="https://sysout.ru/nastrojka-cors-v-spring-security/" rel="nofollow">https://sysout.ru/nastrojka-cors-v-spring-security/</a>.

Суть в двух словах: по умолчанию Spring не позволяет делать кроссдоменные запросы.
CORS не нужно отключать, а наборот включить и настроить. Другими словами, нужно настроить разрешения в приложении откуда разрешать запросы. Примеры заголовков:
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">Access-Control-Allow-Origin: *
Access-Control-Allow-Origin: http://localhost:9999
</pre></div>

Необходимые настройки сделаны в <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/src/main/kotlin/ru/perm/v/shopkotlin/config/CorsFilter.kt" rel="nofollow">https://github.com/cherepakhin/shop_kotlin/blob/dev/src/main/kotlin/ru/perm/v/shopkotlin/config/CorsFilter.kt</a>
<a id="test_run"></a>
<h3>Тестовый запуск</h3>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew bootRun
</pre></div>

<p dir="auto"> </p>
<a id="bootjar"></a>
<h3 dir="auto">Создание запускаемого файла и его запуск</h3>
<p dir="auto">Создание:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">./gradlew bootJar
</pre></div>

<p dir="auto">(<strong>bootJar</strong> не <strong>bootRun!!!</strong>)</p>
<p dir="auto">Собранный файл будет в папке <strong>./build/libs/</strong></p>
<p dir="auto">запуск с RAM 256Мб:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">shop_kotlin/$ java -Xmx256M -jar build/libs/shop_kotlin-0.1.20.jar
</pre></div>
<p dir="auto">или так:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">shop_kotlin/$ cd build/libs
shop_kotlin/build/libs$ java -Xmx256M -jar shop_kotlin-0.1.20.jar
</pre></div>

<p dir="auto"> </p>
<a id="publish_fat-jar"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-publishing-springboot-fat-jar" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#publishing-springboot-fat-jar"></a>Publishing SpringBoot "FAT" jar</h3>
<p dir="auto">Настройка:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">publishing {
  repositories {
      maven {
          url = uri("https://v.perm.ru:8082/repository/ru.perm.v/")
          isAllowInsecureProtocol = true
          //  for publish to nexus "./gradlew publish"
          // export NEXUS_CRED_USR=admin
          // echo $NEXUS_CRED_USR
          credentials {
              username = System.getenv("NEXUS_CRED_USR")
              password = System.getenv("NEXUS_CRED_PSW")
          }
      }
  }
  publications {
    create<span style="color: #007700"><MavenPublication></span>("maven"){
      artifact(tasks["bootJar"]) // build and publish bootJar
    }
}
</pre></div>
<p dir="auto"><a href="https://stackoverflow.com/questions/64062905/unable-to-publish-jar-to-gitlab-package-registry-with-gradle" rel="nofollow">https://stackoverflow.com/questions/64062905/unable-to-publish-jar-to-gitlab-package-registry-with-gradle</a></p>
<p dir="auto"> </p>

<a id="httpie"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-примеры-тестов-httpie" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B-%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2-httpie"></a>Примеры тестов <a href="https://httpie.io/" rel="nofollow">httpie</a>
</h3>
<p dir="auto">Echo запрос для простой проверки работоспособности (:8980/shop_kotlin/ базовый путь проекта):</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">$ </span>http :8980/shop_kotlin/api/echo/aaa

HTTP/1.1 200
Connection: keep-alive
Content-Length: 3
Content-Type: text/plain;charset<span style="color: #333333">=</span>UTF-8
Date: Thu, 15 Jun 2023 07:30:38 GMT
Keep-Alive: <span style="color: #996633">timeout</span><span style="color: #333333">=</span>60

aaa
</pre></div>
<p dir="auto">Поиск по имени Product:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">$ </span>http :8980/shop_kotlin/api/group_product/find?name<span style="color: #333333">=</span><span style="background-color: #fff0f0">'Comp'</span>

<span style="color: #333333">[</span>
    <span style="color: #333333">{</span>
        <span style="background-color: #fff0f0">"haveChilds"</span>: <span style="color: #007020">true</span>,
        <span style="background-color: #fff0f0">"id"</span>: 2,
        <span style="background-color: #fff0f0">"name"</span>: <span style="background-color: #fff0f0">"Computers"</span>,
        <span style="background-color: #fff0f0">"parentId"</span>: 1
    <span style="color: #333333">}</span>,
    <span style="color: #333333">{</span>
        <span style="background-color: #fff0f0">"haveChilds"</span>: <span style="color: #007020">false</span>,
        <span style="background-color: #fff0f0">"id"</span>: 3,
        <span style="background-color: #fff0f0">"name"</span>: <span style="background-color: #fff0f0">"Desktop Computers"</span>,
        <span style="background-color: #fff0f0">"parentId"</span>: 2
    <span style="color: #333333">}</span>
</pre></div>
<p dir="auto">POST запрос на изменение Product:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">$ </span>http POST :8980/shop_kotlin/api/product/ < ./src/test/json_test/product.json
</pre></div>

<p dir="auto"> </p>

<a id="datajpa_restassured_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-интеграционное-тестирование" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"></a>Интеграционное тестирование
</h3>
<a id="datajpa_test"></a>
<p dir="auto">Два варианта тестирования - cо Spring @DataJpaTest и через RestAssured (это bdd тестирование). Совершенно разные тесты, для совершенно разных целей. DataJpaTest на уровне БД, RestAssured - сквозное тестирование от rest до БД.</p>
<p dir="auto"> </p>
<h4 dir="auto" tabindex="-1">
    <a tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#datajpatest">DataJPA test</a>
</h4>
<p dir="auto">Тестируется работа с базой данных с использованием <a href="https://www.baeldung.com/kotlin/spring-boot-testing#1-test-repository-using-datajpatest" rel="nofollow">@DataJpaTest</a>.
    Находятся в пакете <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/src/test/kotlin/ru/perm/v/shopkotlin/datajpatest">https://github.com/cherepakhin/shop_kotlin/blob/dev/src/test/kotlin/ru/perm/v/shopkotlin/datajpatest</a>.</p>

<p dir="auto"> </p>
<a id="restassured_test"></a>
<h4 dir="auto" tabindex="-1">
    <a tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin_reastassured_test">RestAssured</a>
</h4>
<p dir="auto">Для этих тестов сделан отдельный проект <a href="https://github.com/cherepakhin/shop_kotlin_reastassured_test">https://github.com/cherepakhin/shop_kotlin_reastassured_test</a></p>
<p dir="auto">Результат тестов:</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" title="allure_result_test" src="images/shop_kotlin/allure_result_test.png"
        alt="allure_result_test" width="841" height="565"/></p>

<p dir="auto"> </p>
<a id="docker"></a>
<h3 dir="auto" tabindex="-1"><a id="user-content-docker" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#docker"></a>Docker</h3>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/Dockerfile">Dockerfile</a></p>
<p dir="auto">Работа с Docker:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888"># create docker image</span>
<span style="color: #996633">$.</span>/docker_build.sh

<span style="color: #888888"># run app</span>
<span style="color: #996633">$ </span>docker run -p 8080:8980 shop_kotlin/app

<span style="color: #996633">$ </span>docker ps
CONTAINER ID   IMAGE             COMMAND                CREATED          STATUS          PORTS                    NAMES
c70ef82f3a54   shop_kotlin/app   <span style="background-color: #fff0f0">"java -jar /app.jar"</span>   43 seconds ago   Up 42 seconds   0.0.0.0:8080->8980/tcp   inspiring_germain

<span style="color: #888888"># simple test</span>
<span style="color: #996633">$ </span>http :8080/api/group_product/find?name<span style="color: #333333">=</span><span style="background-color: #fff0f0">'Comp'</span>

<span style="color: #996633">$ </span>docker ps -a
<span style="color: #888888"># 2d1325e1222a   shop_kotlin:0.24.0105    "/cnb/process/web" ...</span>

<span style="color: #888888"># stop docker app</span>
<span style="color: #996633">$docker</span> stop 2d1

<span style="color: #888888"># rm container shop_kotlin 2d1325e1222a (id from docker ps -a)</span>
<span style="color: #996633">$docker</span> container rm 2d1

<span style="color: #888888"># rm image</span>
<span style="color: #996633">$docker</span> image ls
shop_kotlin 0.24.0105   94560d28efb3   ...

<span style="color: #996633">$ </span>docker image rm 945
Untagged: shop_kotlin:0.24.0105

<span style="color: #888888"># clear ALL images</span>
<span style="color: #996633">$docker</span> image prune -a

<span style="color: #888888"># clear all</span>
<span style="color: #996633">$docker</span> system prune -af
</pre></div><br/>
<h4 dir="auto" tabindex="-1"><a id="user-content-или-средствами-gradle" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D0%BB%D0%B8-%D1%81%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B2%D0%B0%D0%BC%D0%B8-gradle"></a>ИЛИ средствами gradle:</h4>
<p dir="auto">Создание docker image:</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">$ </span>./gradlew bootBuildImage

...

    <span style="color: #333333">[</span>creator<span style="color: #333333">]</span>     Saving docker.io/library/shop_kotlin:0.1.18...
    <span style="color: #333333">[</span>creator<span style="color: #333333">]</span>     *** Images <span style="color: #333333">(</span>f80a4e623a3d<span style="color: #333333">)</span>:
    <span style="color: #333333">[</span>creator<span style="color: #333333">]</span>           docker.io/library/shop_kotlin:0.1.18
Successfully built image <span style="background-color: #fff0f0">'docker.io/library/shop_kotlin:0.1.18'</span>
...
</pre></div>

<p dir="auto">В файле META-INF/MANIFEST.MF указать Main-Class</p>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">Main-Class: ru.perm.v.shopkotlin.ShopKotlinApplication
</pre></div>

<p dir="auto">Запуск docker image:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ docker run -p 8980:8980 -p 8988:8988  docker.io/library/shop_kotlin:0.1.18
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">(8980 - основной порт, 8988 - spring actuator)</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ docker container ls
CONTAINER ID   IMAGE                COMMAND              CREATED          STATUS          PORTS                    NAMES
6544af7b0adb   shop_kotlin:0.1.18   <span class="pl-s"><span class="pl-pds">"</span>/cnb/process/web<span class="pl-pds">"</span></span>   12 seconds ago   Up 11 seconds   0.0.0.0:8980-<span class="pl-k">&gt;</span>8980/tcp   brave_sutherland
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Проверка:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ http http://127.0.0.1:8980/shop_kotlin/api/echo/aaa

HTTP/1.1 200
Connection: keep-alive
Content-Length: 3
Content-Type: text/plain<span class="pl-k">;</span>charset=UTF-8
Date: Thu, 30 Nov 2023 15:36:25 GMT
Keep-Alive: timeout=60
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers

aaa
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<a id="swagger"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-swagger" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#swagger"></a>Swagger
</h3>
<p dir="auto">Swagger доступен по адресу <a href="http://127.0.0.1:8980/shop_kotlin/api/swagger-ui/" rel="nofollow">http://127.0.0.1:8980/shop_kotlin/api/swagger-ui/</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/swagger.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/swagger.png" alt="swagger" /></a></p>

<p dir="auto"> </p>
<a id="spring_actuator"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-spring-actuator" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#spring-actuator"></a>Spring Actuator
</h3>
<p dir="auto">Spring Actuator предназначен для получения информации о работающем приложении - статус приложения (жив/нет), использовании памяти, cpu и т.п.. Поключен по адресу <a href="http://127.0.0.1:8988/shop_kotlin/api/actuator" rel="nofollow">http://127.0.0.1:8988/shop_kotlin/api/actuator</a></p>
<p dir="auto">порт указан в application.yaml:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-ent">management</span>:
  <span class="pl-s">...</span>
  <span class="pl-ent">server</span>:
    <span class="pl-ent">port</span>: <span class="pl-c1">8988</span>
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Использование из командной строки:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ http http://127.0.0.1:8988/shop_kotlin/api/actuator

{
    <span class="pl-s"><span class="pl-pds">"</span>_links<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>beans<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://127.0.0.1:8988/shop_kotlin/api/actuator/beans<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>templated<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
        },
        <span class="pl-s"><span class="pl-pds">"</span>caches<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://127.0.0.1:8988/shop_kotlin/api/actuator/caches<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>templated<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
        },
        <span class="pl-s"><span class="pl-pds">"</span>caches-cache<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://127.0.0.1:8988/shop_kotlin/api/actuator/caches/{cache}<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>templated<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>
        },
....</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/actuator.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/actuator.png" alt="actuator" /></a></p>
<p dir="auto">Пример "Сколько памяти используется?":</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ http http://127.0.0.1:8988/shop_kotlin/api/actuator/metrics/jvm.memory.used
....
<span class="pl-s"><span class="pl-pds">"</span>baseUnit<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>bytes<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The amount of used memory<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>measurements<span class="pl-pds">"</span></span>: [
        {
            <span class="pl-s"><span class="pl-pds">"</span>statistic<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>VALUE<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>: 147665416.0
        }
    ],
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>jvm.memory.used<span class="pl-pds">"</span></span>
....</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Нагрузочные тесты показали следующие результаты: 64M - приложение выпадает с OutOfMemory 128M - тесты проходят</p>

<p dir="auto"> </p>
<a id="prometheus"></a>
<h3 dir="auto" tabindex="-1"><a id="user-content-prometheus" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#prometheus"></a>Prometheus</h3>
<p dir="auto">На моем сервере запущен Prometheus. Prometheus <strong>ОПРАШИВАЕТ</strong> приложение, согласно заданию (ниже yaml), и собирает метрики (metrics_path+targets). Пример задания для опроса в файле <a href="https://github.com/cherepakhin/shop_kotlin/doc/prometheus/prometheus.yml">doc/prometheus/prometheus.yml</a>. Содержимое <a href="https://github.com/cherepakhin/shop_kotlin/doc/prometheus/prometheus.yml">doc/prometheus/prometheus.yml</a> поместить в настройки prometheus. Пример задания:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-ent">scrape_configs</span>:
- <span class="pl-ent">job_name</span>: <span class="pl-s"><span class="pl-pds">'</span>spring boot scrape<span class="pl-pds">'</span></span>
  <span class="pl-ent">metrics_path</span>: <span class="pl-s"><span class="pl-pds">'</span>/shop_kotlin/api/actuator/prometheus<span class="pl-pds">'</span></span>
  <span class="pl-ent">scrape_interval</span>: <span class="pl-c1">5s</span>
  <span class="pl-ent">static_configs</span>:
    - <span class="pl-ent">targets</span>: <span class="pl-s">['192.168.1.20:8988']</span>
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Опрашивать '192.168.1.20:8988/shop_kotlin/api/actuator/prometheus' каждые 5 сек.</p>
<p dir="auto">Для просмотра получаемых prometheus-ом метрик можно выполнить:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>$ http http://127.0.0.1:8788/api/actuator/prometheus<span class="pl-k">**</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">(Использован <a href="https://httpie.io/" rel="nofollow">httpie</a>)</p>
<p dir="auto">Ответ:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code># HELP jvm_threads_daemon_threads The current number of live daemon threads
# TYPE jvm_threads_daemon_threads gauge
jvm_threads_daemon_threads 13.0
# HELP hikaricp_connections Total connections
...
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Подключение к Prometheus из браузера: <a href="http://192.168.1.20:9090/targets" rel="nofollow">http://192.168.1.20:9090/targets</a></p>
<p dir="auto"><a href="http://192.168.1.20:9090/graph" rel="nofollow">http://192.168.1.20:9090/graph</a></p>
<p dir="auto">Основной экран: 192.168.1.20 - адрес хоста с prometheus <a href="http://192.168.1.20:9090/targets" rel="nofollow">http://192.168.1.20:9090/targets</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/prometheus_1_20_9090.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/prometheus_1_20_9090.png" alt="Основной экран" /></a></p>
<p dir="auto">Меню: Status/Targets <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/prometheus_status_targets.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/prometheus_status_targets.png" alt="Статус" /></a></p>
<p dir="auto">Приложение остановлено:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/shop_kotlin_down.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/shop_kotlin_down.png" alt="Приложение остановлено" /></a></p>
<p dir="auto">Приложение запущено:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/shop_kotlin_up.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/shop_kotlin_up.png" alt="Приложение остановлено" /></a></p>
<p dir="auto"> </p>

<a id="show_cpu_prometheus"></a>
<h3 dir="auto">Пример просмотра использования CPU в Prometheus</h3>
<p dir="auto">Prometheus запущен на 192.168.1.20:9090</p>
<p dir="auto">Перейти на <a href="http://192.168.1.20:9090/" rel="nofollow">http://192.168.1.20:9090</a> В меню "Graph":</p>
<ol dir="auto">
    <li>В "Expression" ввести system_cpu_usage</li>
    <li>Перейти на Graph</li>
    <li>Отрегулировать период (н.п. 15 мин.)</li>
</ol>
<p dir="auto">Итоговый запрос: <a href="http://192.168.1.20:9090/graph?g0.range_input=15m&amp;g0.expr=system_cpu_usage&amp;g0.tab=0" rel="nofollow">http://192.168.1.20:9090/graph?g0.range_input=15m&amp;g0.expr=system_cpu_usage&amp;g0.tab=0</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/prometheus_system_cpu_usage.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/prometheus_system_cpu_usage.png" alt="prometheus_system_cpu_usage" /></a></p>

<p dir="auto"> </p>
<a id="prometheus_docker"></a>
<h3 dir="auto">Запуск prometheus в docker:</h3>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>docker run -d -p 9090:9090 -v <span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">$(</span>pwd<span class="pl-pds">)</span>/for_prometheus/prometheus.yml<span class="pl-pds">"</span></span>:/etc/prometheus/prometheus.yml prom/prometheus</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Просмотр состояния prometheus, запущенного в docker:</p>
<p dir="auto">Вычисление ID container</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">&gt;</span>docker ps
CONTAINER ID   IMAGE             COMMAND                  CREATED         STATUS         PORTS                    NAMES
e081bb1f500c   prom/prometheus   <span class="pl-s"><span class="pl-pds">"</span>/bin/prometheus --c…<span class="pl-pds">"</span></span>   4 minutes ago   Up 4 minutes   0.0.0.0:9090-<span class="pl-k">&gt;</span>9090/tcp   reverent_newton</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Просмотр логов контейнера prometheus (e08 id контейнера)</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>docker logs e08 --follow</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Выхлоп:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code>...
ts=2023-09-11T13:13:17.850Z caller=main.go:1009 level=info msg="Server is ready to receive web requests."
ts=2023-09-11T13:13:17.850Z caller=manager.go:1009 level=info component="rule manager" msg="Starting rule manager..."
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>

<p dir="auto"> </p>
<a id="grafana"></a>
<h3 dir="auto">
    <a id="user-content-grafana" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#grafana"></a>Grafana</h3>
<p dir="auto">Graphana отображает метрики, собранные Prometheus. На домашнем сервере развернута Grafana. На каринках ниже отображено использование CPU двух приложений, расположенных на двух разных хостах в упрощенном и полном формате:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/grafana_short" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/grafana_short.png" alt="grafana" /></a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/grafana.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/grafana.png" alt="grafana" /></a></p>
<p dir="auto">Запуск grafana:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>vasi@v$ sudo service grafana-server start</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Остановка grafana:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>vasi@v$ sudo service grafana-server stop</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="http://192.168.1.20:3000/explore?orgId=1&amp;left=%7B%22datasource%22:%22grafana%22,%22queries%22:%5B%7B%22queryType%22:%22randomWalk%22,%22refId%22:%22A%22,%22datasource%22:%7B%22type%22:%22datasource%22,%22uid%22:%22grafana%22%7D%7D%5D,%22range%22:%7B%22from%22:%22now-6h%22,%22to%22:%22now%22%7D%7D" rel="nofollow">Пример запроса</a></p>
<p dir="auto">user(pass): admin/admin</p>
<p dir="auto">Подробнее о нагрузочном тестировании и метриках в этом проекте <a href="https://github.com/cherepakhin/shop_kotlin_yandex_tank_test">https://github.com/cherepakhin/shop_kotlin_yandex_tank_test</a></p>

<p dir="auto"> </p>
<a id="caching"></a>
<h3 dir="auto">
    <a id="user-content-кеширование" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BA%D0%B5%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"></a>Кеширование
</h3>
<p dir="auto">Кеширование сделано для RestController:</p>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre>@GetMapping(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>)
@Cacheable(<span class="pl-s"><span class="pl-pds">"</span>allGroupProductDTO<span class="pl-pds">"</span></span>)
@ApiOperation(<span class="pl-s"><span class="pl-pds">"</span>Get all groups of product<span class="pl-pds">"</span></span>)
<span class="pl-k">fun</span> <span class="pl-en">all</span>(): <span class="pl-c1">List</span>&lt;<span class="pl-en">GroupProductDTO</span>&gt; {
    <span class="pl-k">..</span>.
}</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Использован <a href="https://spring-projects.ru/guides/caching/" rel="nofollow">org.springframework.cache</a>. Ручная проверка работы кеш:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-c"># Очистка кеша</span>
<span class="pl-smi">$http</span> :8780/api/group_product/clear_cache
<span class="pl-c"># Для проверки, несколько раз сделать get запрос. </span>
<span class="pl-c"># При этом в лог будет только один запрос к репозиторию.</span>
<span class="pl-smi">$http</span> :8780/api/group_product/
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<a id="jenkins"></a>
<h3 dir="auto" tabindex="-1">Сборка Jenkins</h3>
<p dir="auto">Сборка происходит в Jenkins, развернутом на домашнем сервере. Pipeline для Jenkins описан в файле <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/Jenkinsfile">./Jenkinsfile</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jenkins_build_4_step.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jenkins_build_4_step.png" alt="jenkins" /></a></p>
<blockquote>
    <p dir="auto">Установка и настройка домашнего Jenkins описана в <a href="index.php/50-organizatsiya-sobstvennogo-ci-cd" rel="nofollow">https://v.perm.ru/main/index.php/50-organizatsiya-sobstvennogo-ci-cd</a></p>
</blockquote>
<p dir="auto">Для ограничения памяти при сборке Gradle, добавлен параметр в gradle.properties:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>org.gradle.jvmargs=-Xmx512M</pre>
    <div class="zeroclipboard-container"> </div>
</div>

<p dir="auto"> </p>
<a id="nexus"></a>
<h3 dir="auto" tabindex="-1">Nexus</h3>
<p dir="auto">В проекте используется внешняя зависимость из домашнего NEXUS репозитория <a href="https://github.com/cherepakhin/shop_kotlin_extdto">https://github.com/cherepakhin/shop_kotlin_extdto</a>:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>implementation(<span class="pl-s"><span class="pl-pds">"</span>ru.perm.v:shop_kotlin_extdto:0.0.3<span class="pl-pds">"</span></span>)</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-deploy-to-nexus-repository" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#deploy-to-nexus-repository"></a>Deploy to NEXUS repository</h3>
<p dir="auto">Возможен с использованием Jenkins (описано выше) или ручной deploy в Nexus с личного компьютера.</p>
<p dir="auto">Для deploy выполнить:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>./gradlew publish</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Путь к репозиторию установлен в build.gradle.kts:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>url = uri(<span class="pl-s"><span class="pl-pds">"</span>https://v.perm.ru:8082/repository/ru.perm.v/<span class="pl-pds">"</span></span>)</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Для установки переменных доступа к Nexus repository выполнить в shell:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ <span class="pl-k">export</span> NEXUS_CRED_USR=admin
$ <span class="pl-k">export</span> NEXUS_CRED_PSW=pass</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/nexus.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/nexus.png" alt="nexus" /></a></p>
<p dir="auto">Секция publishing в build.gradle.kts:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>publishing {
    repositories {
        maven {
            url = uri(<span class="pl-s"><span class="pl-pds">"</span>https://v.perm.ru:8082/repository/ru.perm.v/<span class="pl-pds">"</span></span>)
            isAllowInsecureProtocol = <span class="pl-c1">true</span>
            //  publish в nexus <span class="pl-s"><span class="pl-pds">"</span>./gradlew publish<span class="pl-pds">"</span></span> из ноута и Jenkins проходит
            // <span class="pl-k">export</span> NEXUS_CRED_USR=admin
            // <span class="pl-c1">echo</span> <span class="pl-smi">$NEXUS_CRED_USR</span>
            credentials {
                username = System.getenv(<span class="pl-s"><span class="pl-pds">"</span>NEXUS_CRED_USR<span class="pl-pds">"</span></span>)
                password = System.getenv(<span class="pl-s"><span class="pl-pds">"</span>NEXUS_CRED_PSW<span class="pl-pds">"</span></span>)
            }
        }
    }
    publications {
        register(<span class="pl-s"><span class="pl-pds">"</span>mavenJava<span class="pl-pds">"</span></span>, MavenPublication::class) {
            groupId
            artifactId
            version
            from(components[<span class="pl-s"><span class="pl-pds">"</span>java<span class="pl-pds">"</span></span>])
        }</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<a id="jmc"></a>
<h3 dir="auto" tabindex="-1">Просмотр ресурсов с помощью Java Mission Control</h3>
<p dir="auto"><a href="https://www.oracle.com/cis/javase/jmc/" rel="nofollow">Java Mission Control</a></p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>jmc-8.3.1_linux-x64/JDK Mission Control$ jmc</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jmc_monitor.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jmc_monitor.png" alt="jmc" /></a></p>
<p dir="auto"> </p>

<a id="logging"></a>
<h3 dir="auto">Логирование</h3>
<p dir="auto">Настройка сделана в application.yaml:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-ent">logging</span>:
  <span class="pl-ent">level</span>:
    <span class="pl-ent">root</span>: <span class="pl-s">info</span>
  <span class="pl-ent">file</span>:
    <span class="pl-ent">path</span>: <span class="pl-s">log/</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>

<a id="easycode_idea"></a>
<h3 dir="auto">Использование "ChatGPT-EasyCode" в Idea</h3>

<p dir="auto">Пример работы плагина <a href="https://plugins.jetbrains.com/plugin/20603-chatgpt--easycode" rel="nofollow">Idea EasyCode</a> для автодополнения кода : <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/chatgpt_easycode/easycode_demo_worked.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/chatgpt_easycode/easycode_demo_worked.png" alt="demo ChatGPT-EasyCode" /></a></p>
<p dir="auto">Серым выделена подсказка EasyCode. "TAB" - принять предложение.</p>

<a id="easycode_vscode"></a>
<p dir="auto"> </p>
<h3 dir="auto">Использование "ChatGPT-EasyCode" в VSCode</h3>
<p dir="auto">Генерация тестов <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/chatgpt_easycode/run_write_test_easycode.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/chatgpt_easycode/run_write_test_easycode.png" alt="Сгенерировать тесты ChatGPT-EasyCode" /></a></p>
<p dir="auto">Рефакторинг <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/chatgpt_easycode/run_refactor_easycode.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/chatgpt_easycode/run_refactor_easycode.png" alt="Рефакторинг ChatGPT-EasyCode" /></a></p>
<p dir="auto"><strong>Вещь!</strong></p>
<p dir="auto">А отечественный GigaCode, в течении <b>нескольких недель</b>, отвечал унылым <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/gigacode.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/gigacode.png" alt="" /></a></p>
и в конце концов какие-то шестеренки провернулись:
<img style="display: block; margin-left: auto; margin-right: auto;" title="gigacode" src="images/chatgpt/gigacode_ok.png"
     alt="gigacode" width="768" height="343"/><br/>
В IntelliJ IDEA 2023.3.2 (Community Edition):<br/>
<img style="display: block; margin-left: auto; margin-right: auto;" title="gigacode" src="images/chatgpt/gigacode.png"
     alt="gigacode" width="402" height="47"/>

<a id="add_param_to_application_yaml"></a>
<h3 dir="auto">Частный параметр конфигурации в application.yaml</h3>
<p dir="auto">Бывает нужно добавить <b>СВОЙ</b> параметр конигурации в <b>application.yaml</b> для удобства тестирования, разработки, развертывания.
    Пример описан в проекте:
    <a class="anchor" tabindex="-1" href="https://github.com/cherepakhin/camel_rest">https://github.com/cherepakhin/camel_rest</a> в разделе "Дополнительно".
    В <b>application.yaml</b> добавлен <b>ЧАСТНЫЙ</b> параметр конфигурации <b>"myconfig"</b>.<br/>
    <br/>
    Описание:<br/>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre>@ConfigurationProperties("myconfig")
@ConstructorBinding
data class MyConfig(val testDirectory: String)
</pre>

    Объявление в application.yaml:<br/>
    <pre>myconfig:
    testDirectory: file:~/temp/testarea
</pre>
    Использование:<br/>
    <pre><code lang="kotlin">@RestController
class ParamCtrl {

    @Autowired
    lateinit var myConfig: MyConfig

    @GetMapping("/test_directory")
    fun getTestDirectory(): String? {
        logger.info("GET param test_directory=${myConfig.testDirectory}")
        return myConfig.testDirectory
    }
}
</code></pre>

    <a id="set_var_application_yaml"></a>
    <h3 dir="auto">Переопределение значения переменных application.yaml</h3>
    <p dir="auto">Можно задать значения переменных application.yaml через специальную переменную <b>SPRING_APPLICATION_JSON</b>. Пример замены порта приложения на <b>8960</b>
        (в application.yaml server:  port=<b>8980</b>):</p>
    <pre><code lang="kotlin">$ export SPRING_APPLICATION_JSON='{"server":{"port":<b>8960</b>}}'
$ java -jar build/libs/spring_config_k-0.0.1-SNAPSHOT.jar
....
INFO 23327 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): <b>8960</b> (http)
....
</code></pre>

    <a id="todo"></a>
    <p dir="auto"> </p>
    <h3 dir="auto" tabindex="-1"><a id="user-content-todo" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#todo"></a>TODO</h3>
    <ul dir="auto">
        <li><del>cache on rest (сделано)</del></li>
        <li><del>RestAssured tests (сделано)</del> (<a href="https://github.com/cherepakhin/shop_kotlin_reastassured_test">https://github.com/cherepakhin/shop_kotlin_reastassured_test</a>)</li>
        <li><del>by lazy (сделано)</del></li>
        <li><del>Docker (сделано)</del></li>
        <li><del>Swagger (сделано)</del></li>
        <li><del>Actuator (сделано)</del></li>
        <li><del>flyway (использована БД в памяти url: jdbc:h2:mem:easybotdb). Миграции не требуются.</del></li>
        <li>webmvc тесты (ProductRestMockMvcTest)</li>
        <li><del>тесты service слоя с СУБД @DataJpaTest (сделано)</del></li>
        <li>вертикальные БД (?)</li>
        <li><del>Различные SQL запросы через native Sql и Spring JPA(order by, group by) (сделано)</del></li>
        <li>Pagination</li>
        <li><del>Grafana (сделано)</del></li>
        <li>ElasticSearch</li>
        <li>Авторизация</li>
    </ul>

    <a id="tose"></a>
    <p dir="auto"> </p>
    <h3 dir="auto" tabindex="-1"><a id="user-content-примечания" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%87%D0%B0%D0%BD%D0%B8%D1%8F"></a>Примечания:</h3>
    <p dir="auto">В программе не используются слои controller и service, т.к. проект сделан только для демонстрации Kotlin, и не планируется какая-либо бизнес-логика. Конвертация в DTO сделана в REST контроллерах.</p>
    <p dir="auto">Поля в <strong>entity</strong> классах д.б. обозначены <strong>"open"</strong> (н.п. <strong>open</strong> val name: String = ""). В Kotlin используется следующий подход - можно наследовать от суперклассов и переопределять их свойства и функции только в том случае, если они снабжены префиксом <strong>"open"</strong>.</p>
    <p dir="auto">Имя для "id" поля в entity классах названы "n". Причины:</p>
    <ul dir="auto">
        <li>В некоторых БД "id" ключевое слово</li>
        <li>В interface repository есть отдельные методы repository.getById(), repository.findById(). Имеется ввиду поиск по primary key. Это путает.</li>
    </ul>
    <p dir="auto">Правила использования модификатора <strong>lateinit</strong>:</p>
    <ul dir="auto">
        <li>используется только совместно с ключевым словом var;</li>
        <li>свойство может быть объявлено только внутри тела класса (не в основном конструкторе);</li>
        <li>тип свойства не может быть нулевым и примитивным;</li>
        <li>у свойства не должно быть пользовательских геттеров и сеттеров;</li>
        <li>с версии Kotlin 1.2 можно применять к свойствам верхнего уровня и локальным переменным.</li>
        <li>сообщает что инициализация будет как-то сделана (в примере ниже аннотациями @Mock, @InjectMocks). @Mock mockProductService будут инжектированы в @InjectMocks productRest. Пример:</li>
    </ul>
    <div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">internal</span> <span class="pl-k">class</span> <span class="pl-en">ProductRestTest</span> {
    @Mock
    <span class="pl-k">private</span> <span class="pl-k">lateinit</span> <span class="pl-k">var</span> mockProductService<span class="pl-k">:</span> <span class="pl-en">ProductService</span>

    @InjectMocks
    <span class="pl-k">private</span> <span class="pl-k">lateinit</span> <span class="pl-k">var</span> productRest<span class="pl-k">:</span> <span class="pl-en">ProductRest</span>
    <span class="pl-k">..</span>.
}

</pre>
        <div class="zeroclipboard-container"> </div>
    </div>
    <p dir="auto"><strong>byLazy</strong></p>
    <div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
        <pre><span class="pl-k">val</span> catName<span class="pl-k">:</span> <span class="pl-c1">String</span> by lazy { getName() }</pre>
        <div class="zeroclipboard-container"> </div>
    </div>
    <p dir="auto">свойство объявлено как <strong>VAL</strong>, но присвоение будет выполнено при <strong>первом использовании</strong> и потом уже не будет инициализироваться.</p>
    <p dir="auto"><strong>Ссылки о lazy и lateinit:</strong></p>
    <ul dir="auto">
        <li><a href="https://github.com/cherepakhin/kotlin_in_action">https://github.com/cherepakhin/kotlin_in_action</a></li>
        <li><a href="https://developer.alexanderklimov.ru/android/kotlin/lateinit.php" rel="nofollow">https://developer.alexanderklimov.ru/android/kotlin/lateinit.php</a></li>
        <li><a href="https://www.baeldung.com/kotlin/lazy-initialization" rel="nofollow">https://www.baeldung.com/kotlin/lazy-initialization</a></li>
        <li><a href="https://bimlibik.github.io/posts/kotlin-lateinit-and-lazy/" rel="nofollow">https://bimlibik.github.io/posts/kotlin-lateinit-and-lazy/</a></li>
    </ul>
    <p dir="auto"><strong>Статические члены и компаньон объекты в Kotlin:</strong></p>
    <p dir="auto">Как правило объекты-компаньоны используются для объявления переменных и функций, к которым требуется обращаться без создания экземпляра класса. Либо для объявления констант. По сути они своего рода замена статическим членам класса (в отличие от Java, в Kotlin нет статики).</p>
    <ul dir="auto">
        <li>Как бы static:</li>
    </ul>
    <div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">class</span> <span class="pl-en">Someclass</span> {
  <span class="pl-k">..</span>.
  <span class="pl-k">object</span> AsStaticObject {
    <span class="pl-k">fun</span> <span class="pl-en">create</span>() {
      <span class="pl-k">..</span>.
    }
  }

}

<span class="pl-k">..</span>.

<span class="pl-k">val</span> someClass <span class="pl-k">=</span> <span class="pl-en">SomeClass</span>.<span class="pl-en">AsStaticObject</span>.create()</pre>
        <div class="zeroclipboard-container"> </div>
    </div>
    <ul dir="auto">
        <li>Companion Object (вложенный объект. Метод create() принадлежит родительскому классу):</li>
    </ul>
    <div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">class</span> <span class="pl-en">SomeClass</span> {

  <span class="pl-k">companion</span> <span class="pl-k">object</span> {
    <span class="pl-k">fun</span> <span class="pl-en">create</span>()
  }
}

<span class="pl-k">..</span>.

<span class="pl-k">val</span> someClass <span class="pl-k">=</span> <span class="pl-en">SomeClass</span>.create()</pre>
        <div class="zeroclipboard-container"> </div>
    </div>
    <p dir="auto"><strong>Различия между val и const val в Kotlin</strong></p>
    <div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">val</span> <span class="pl-en">MY_VAL</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>
<span class="pl-k">const</span> <span class="pl-k">val</span> <span class="pl-en">MY_CONST_VAL</span> <span class="pl-k">=</span> <span class="pl-c1">2</span></pre>
        <div class="zeroclipboard-container"> </div>
    </div>
    <ul dir="auto">
        <li>Обе эти переменные немодифицируемые</li>
        <li><strong>MY_VAL</strong> станет приватной переменной, для доступа к которой будет создан геттер</li>
        <li><strong>MY_CONST_VAL</strong> будет заинлайнена, то есть компилятор заменит все полученные значения этой переменной на само значение</li>
        <li><a href="https://www.baeldung.com/kotlin/const-var-and-val-keywords" rel="nofollow">Kotlin const, var, and val Keywords</a></li>
    </ul>
    <p dir="auto"><strong>Ошибка "ERROR: Cannot resume build because FlowNode 19"</strong></p>
    <p dir="auto">Ответ тут <a href="https://community.jenkins.io/t/error-cannot-resume-build-because-flownode-19/9477/3" rel="nofollow">https://community.jenkins.io/t/error-cannot-resume-build-because-flownode-19/9477/3</a></p>
    <p dir="auto">В двух словах: добавить в Jenkinsfile "максмальную выживаемость"</p>
    <div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code>...
pipeline {

    agent any
    options {
        durabilityHint 'MAX_SURVIVABILITY'
    }
...
</code></pre>
        <div class="zeroclipboard-container"> </div>
    </div>
    <ul dir="auto">
        <li>
            <p dir="auto">В Windows на сетевом диске компилировалось с проблемами <strong>query-dsl</strong>. После переноса на <strong>диск C:</strong> проблемы ушли.</p>
        </li>
        <li>
            <p dir="auto">Если появилась ошибка: "./gradlew: строка 2: $'\r': команда не найдена", то выполнить:</p>
        </li>
        <li><p dir="auto">Похоже, при расшаривании папки для Windows и работе в Windows изменился символ конца строки.</p></li>
        <li>Смена версии gradlew: в ./gragle/wrapper/gradle-wrapper.properties <pre class="notranslate"><code>distributionUrl=https\://services.gradle.org/distributions/gradle-7.6.1-bin.zip</code></pre></li>
        <li>Тесты проходят (из idea и из shell)</li>
        <li>Jetty рекомендуют, как более оптимизированный контейнер:
            <div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre class="notranslate"><code>dependencies {
  implementation("org.springframework.boot:spring-boot-starter-web") {
  exclude("org.springframework.boot:spring-boot-starter-tomcat")
  }
  implementation("org.springframework.boot:spring-boot-starter-jetty") // jetty uses less memory
</code></pre></div>
        </li>
        <li>Описание Data class: <a href="https://kotlinlang.ru/docs/reference/data-classes.html" rel="nofollow">https://kotlinlang.ru/docs/reference/data-classes.html</a>.
            "Классы данных <b>не могут быть абстрактными, open, sealed или inner</b>. Компилятор автоматически формирует следующие члены данного класса из <strong>свойств</strong>,
            объявленных <strong>в основном конструкторе</strong>: equals()/hashCode(), toString() в форме "User(name=John, age=42)", компонентные функции componentN(),
            которые соответствуют свойствам, в соответствии с порядком их объявления. Основной конструктор должен иметь как минимум один параметр.
            Все параметры основного конструктора должны быть отмечены, как val или var."</li>
    </ul>

    <p dir="auto"> </p>
    <a id="links"></a>
    <h3 dir="auto" tabindex="-1">Ссылки:</h3>
    <p dir="auto">
    <ul>
        <li><a href="index.php/34-behave-testirovanie" rel="nofollow">Интеграционное тестирование REST</a></li>
        <li><a href="index.php/64-nastrojka-i-ispolzovanie-prometheus-grafana" rel="nofollow">Настройка и использование Prometheus, Grafana</a></li>
        <li><a href="index.php/homepage/56-shpargalka-po-docker" rel="nofollow">Шпаргалка по Docker</a></li>
        <li><a href="index.php/homepage/60-set-java-version" rel="nofollow">Set java version</a></li>
        <li><a href="index.php/50-organizatsiya-sobstvennogo-ci-cd" rel="nofollow">Установка и настройка домашнего Nexus/Jenkins</a></li>
    </ul>