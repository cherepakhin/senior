По мотивам статьи <a href="https://habr.com/ru/articles/675716/" rel="nofollow">Изучаем ResponseEntity<?> и избавляемся от него в контроллерах Spring Boot</a><br/>
В заметке рассмотрено 2 способа:
<p dir="auto">
    <a href="#response_entity">1. Способ с возвратом  ResponseEntity&lt;?&gt;</a><br />
    <a href="#return_object">2. Способ с возвратом объекта</a><br />
</p>
<hr id="system-readmore" />

<a id="response_entity"></a>
<h3>1. Способ с возвратом  ResponseEntity&lt;?&gt;</h3>

Возвращается ResponseEntity&lt;?&gt;.

<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
@GetMapping("/{message}")
public ResponseEntity<?> echo(@PathVariable("message") String message) {
    if (message == null || message.isEmpty() || message.equals("test_error")) {
      return ResponseEntity.status(HttpStatus.BAD_GATEWAY).body("message is empty"); // error cod 502
    }

    if (message.length() < 2) {
        return ResponseEntity.status(HttpStatus.SERVICE_UNAVAILABLE).body("message is too short"); // error cod 503
    } else {
        return ResponseEntity.ok(new SimpleObj(message));
    }
}
</pre></div>
ResponseEntity&lt;?&gt; - это обертка над HttpStatus и Object. Возвращается в любом случае, даже если объект не найден.
Т.е. можно не обрабатывать исключения.

Для более полного описания ошибки можно сделать так (с помощью AppError):

<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
@GetMapping("/products")
public ResponseEntity<?> getProduct(Long id){
    try {
        Product product = productsService.findById(id).orElseThrow();
            return new ResponseEntity<>(product, HttpStatus.OK); // Возврат объекта
    } catch (Exception e) {
        return new ResponseEntity<>(
            new AppError(
                    HttpStatus.NOT_FOUND.value(),
                    "Product with id " + id + " not found"),HttpStatus.NOT_FOUND
            );
        }
}
</pre></div>

где AppError это простой класс:

<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
public class AppError {
    private int statusCode;
    private String message;

    public AppError() {}

    public AppError(int statusCode, String message) {
        this.statusCode = statusCode;
        this.message = message;
    }

    public int getStatusCode() {
        return statusCode;
    }

    public void setStatusCode(int statusCode) {
        this.statusCode = statusCode;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}
</pre></div>

Тестировать с помощью ResponseEntity. Некрасиво, что возвращается в виде ResponseEntity&lt;?&gt;.<br/>
Пример <a href="https://github.com/cherepakhin/response_entity" rel="nofollow">https://github.com/cherepakhin/response_entity</a>

<a id="return_object"></a>
<h3>2. Способ с возвратом объекта</h3>

<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">@RestController
@RequestMapping("/simpleobj")
public class SimpleObjRest {
    @GetMapping("/{message}")
    public SimpleObj getMessageWithExcption(@PathVariable("message") String name) throws MyResourceException {
        if (name.equals("error")) {
            throw new MyResourceException("Exception for name=error");
        }
        return new SimpleObj(name);
    }
}
</pre></div>
где <a href="https://github.com/cherepakhin/object_and_excpt/blob/main/src/main/java/ru/perm/v/simple/MyResourceException.java" rel="nofollow">MyResourceException.java</a> это класс исключения:

<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">public class MyResourceException extends Throwable {
    public MyResourceException(String message) {
        super(message);
    }
}
</pre></div>

и обработка <a href="https://github.com/cherepakhin/object_and_excpt/blob/main/src/main/java/ru/perm/v/simple/MyResourceException.java" rel="nofollow">MyResourceException</a> через Advice и Handler в классе <a href="https://github.com/cherepakhin/object_and_excpt/blob/main/src/main/java/ru/perm/v/simple/GlobalExceptionHandler.java" rel="nofollow">GlobalExceptionHandler.java</a>:
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
@ControllerAdvice // <---------------- Advice
public class GlobalExceptionHandler extends ResponseEntityExceptionHandler { // <---------  Handler
    private static Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);

    @ExceptionHandler
    public ResponseEntity catchResourceNotFoundException(MyResourceException e) { // <---- MyResourceException !!!
        logger.error("GlobalExceptionHandler.catchResourceNotFoundException");
        logger.error(e.getMessage(), e);
        return new ResponseEntity(new AppError(e.getMessage()), HttpStatus.SERVICE_UNAVAILABLE); // <- AppError !!!
    }
}
</pre></div>
где <a href="https://github.com/cherepakhin/object_and_excpt/blob/main/src/main/java/ru/perm/v/simple/AppError.java" rel="nofollow">AppError.java</a>:
<div style="background: #ffffff; overflow:auto;width:auto;border:solid #020274;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
public class AppError {
    private String message;

    public AppError() {
        this("Internal Server Error");
    }

    public AppError(String message) {
        this.message = message;
    }

    public String getMessage() {
        return message;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof AppError)) return false;
        AppError appError = (AppError) o;
        return Objects.equals(message, appError.message);
    }

    @Override
    public int hashCode() {
        return Objects.hashCode(message);
    }
}
</pre></div>

(про ResponseBody см. <a href="https://www.baeldung.com/spring-request-response-body" rel="nofollow">https://www.baeldung.com/spring-request-response-body</a>).<br/>
Просто тестировать.<br/>
Пример <a href="https://github.com/cherepakhin/object_and_excp" rel="nofollow">https://github.com/cherepakhin/object_and_excp</a><br/>


<h3>Ссылки:</h3>
<a href="https://www.thymeleaf.org/doc/tutorials/3.1/thymeleafspring.html" rel="nofollow">Tutorial: Thymeleaf + Spring</a><br/>
