<p>Вообще кто такой сеньор? Знания java? Или знания проекта? Или "по жизни"? Нет ответа. И все таки
    - <b>косяки</b> которые в сфере сеньора, как я это дело понимаю. Тезисно, ни разу не писатель.
</p>
<h3><b>Стиль</b></h3>
<p>Смешивание логики слоев (обращения к БД прямо из rest).</p>
<hr id="system-readmore"/>
<p><span style="font-weight: 400;"><span
            style="text-decoration: underline;"> DTO игнорируется</span>. Наружу отдаются “бородатые” Database Entity, которые сложно документировать и понимать фронту, связывают руки бек-эндерам при изменении БД, тестировщики вешаются.<br/><br/></span><span
        style="font-weight: 400;"> Жирные классы среднего слоя, нужно дробить. Делить по функционалу. Существуеткакой-то психологический барьер, когда нужно добавить новый класс.<br/><em>(для кого я это написал, это и так на всех заборах и собеседованиях, а гляньте-ка на свой service слой. Что-то типа ShopRestController, ShopServiceImplementation. И никаких вариаций типа выделить PriceRestController из ShopRestController, тут же сразу <span
                style="text-decoration: underline;">захочется</span> PriceServiceImplementation выделить из ShopServiceImplementation и т.п.).</em><br/></span>
</p>
<h3><b>Архитектура</b></h3>
<p><span style="font-weight: 400;">Архитектура кода приложения никак не контролируется. Если нужна какая-то новая функциональность, выбор размещения места для кода почти случаен (ибо scrum). Лайфхак: перед тем как писать новое или багфиксить, кратенько обсуждаем план. Ничего нового, слушаем друг друга. <br/> <br/> </span><span
        style="font-weight: 400;">Про кеши все дружно забываем. <br/><br/> Необоснованное, бесконтрольное использование promise. И вообще: promise в Spring как-то очень подозрительно выглядит.<br/></span>
</p>
<p><span style="font-weight: 400;">Использование </span><strong>внешних</strong><span
        style="font-weight: 400;"> сервисов, всякие сторонние rest, xml сервисы с их контролем и режимом доступа и т.п. все сложности нужно прятать в отдельном сервисном слое (а лучше вообще в отдельном микросервисе). Из этого слоя показывать только то, что нужно для конкретной системы. Безопасность при обращении наружу опять же проще контролировать devops инженерам.</span>
    <span style="font-weight: 400;"><br/></span></p>
<p><span style="font-weight: 400;"> Вообще все общение микросервисов обычно делается только через REST. Использование очередей при обмене между микросервисами почему-то в <em>игноре</em> на бэке, только REST и точка.<br/><br/> Отдельно тут хочется упомянуть об использовании RabbitMQ. При непродуманном использовании, может ухудшить ситуацию, т.к. он “пушит” в приемный контроллер и создает отдельные потоки, на которые может не хватить ресурсов, если не указать max в rabbit обработчике.<br/> </span><span
        style="font-weight: 400;"><br/></span><span style="font-weight: 400;"> Обращение к бд не кешируются. </span><span
        style="font-weight: 400;"><br/></span></p>
<p><span style="font-weight: 400;"> REST запросы не кешируются. </span></p>
<p><span style="font-weight: 400;"> Rest должен отдавать только то, что должно лежать в отдельной библиотеке DTO. Речь идет о ведении отдельной <b>maven-зависимости</b> DTO. Д.б. согласовано с frontend-разработчиками и им понятно. Можно frontend разработчикам дать доступ к репозиторию DTO и настроить уведомления при изменениях для них. Документирование REST в этом случае сильно упрощается, описано в одном месте и не расползается на 150 вариантов во всяких wiki системах.<br/> </span>
    <span
        style="font-weight: 400;"> Можно рассмотреть 2 модели DTO для REST. <strong>DTOfull</strong> для диалогов и <strong>DTOshort</strong> для списков и т.п. Где какой использовать становится тривиальной задачей, решается за пару минут на дейлике. И не городить <b>отдельный</b> DTO на <strong>каждый</strong> <strong>метод</strong> REST контроллера. А еще можно добавить SimpleDto(long id, string name) когда не решили еще что же мы хотим от REST метода. Ну и заодно это "маячок" типа TODO. Можно от нее наследоваться, т.к. подавляющее кол-во JSON ответов имеют эти поля. Все что отдается наружу все должно быть в модели DTO. Id в DTO все таки нужен. Фронт у себя кеширует ответы, и по id дергает из кэша приложения в браузере, да и вообще не по имени же идентифицировать объект, хотя почему бы и нет.<br/><br/> Второе - это "психологический" момент. Мыслим бизнес сущностями, а не сущностями БД. Entity это средство, а не цель. Frontend разработчикам, аналитикам, тестировщикам, может быть, лучше вообще не знать структуру БД. </span>
</p>
<p>Сценарий: <br/>1. Встречаемся, договариваемся о пути rest и набрасываем параметры запроса и json
    ответа (или лучше выбираем уже существующий DTO). И не выкручиваем руки фронту, они по другому
    мыслят, другими задачами (ну разве что чуток фильтруем их хотелки). В общем договариваемся.<br/>
    2. Держим в курсе этих дел тестировщиков(они сразу уже могут начать писать сценарии
    тестирования).<br/> 3. Идем работать.</p>
<p><span style="font-weight: 400;">Внутри бэка </span><b>возможно</b><span
        style="font-weight: 400;"> использование отдельного слоя DTO для обмена между микросервисами, т.к. внешние DTO регламентированы, а Entity завязаны на базу. Внутренние DTO под свой вкус можно наделать.
        Для конвертации в/из DTO использовал <a
            style="color: #3366ff; text-decoration: underline;"
            href="https://mapstruct.org/" target="_blank"
            rel="noopener noreferrer">mapstruct</a>. <a
            style="color: #3366ff; text-decoration: underline;"
            href="http://modelmapper.org/" target="_blank"
            rel="noopener noreferrer">ModelMapper</a> тоже хорош. Но и рукописные конверторы бывают нужны. Ничего сложного.</span>

</p>
<p><span style="font-weight: 400;"> Обмен между микросервисами может быть не только через REST, но и через очереди, не всегда нужен результат обработки запроса прямо сейчас. Как то забывается частенько. Иногда, достаточно по-быстрому проверить корректность вх.параметров, отправить в очередь запрос, отдать Ок, и "забить" на него. Вроде тривиально, а все равно вокруг одни RESTы при обмене между микросервисами и никаких вариантов. <br/><br/> Многопроектный проект в idea. Если пишешь один, то супер. Если в команде - засада (имхо). Исключение - karaf.</span>
</p>
<p><span style="font-weight: 400;"> Отдельно про camunda. Часто мы встречаемся с бизнес-процессами. Важно их увидеть. И не заниматься реализацией BPM в "рукопашку".</span>
</p>
<h3><b>Тестирование</b></h3>
<p><span
        style="font-weight: 400;"> При создании отчетов о покрытии тестами использовал jacoco.</span>
</p>
<p><strong> <span
            style="font-weight: 400;"> Интеграционные тестирование чаще ручное, хотя есть <span
                style="color: #3366ff;"><strong><span style="text-decoration: underline;"><a
                            style="color: #3366ff; text-decoration: underline;"
                            href="https://pypi.org/project/pytest/" target="_blank"
                            rel="noopener noreferrer">pytest</a></span></strong></span> и скрипты pytest. Утилита <span
                style="text-decoration: underline; color: #3366ff;"><strong><a
                        style="color: #3366ff; text-decoration: underline;" title="behave"
                        href="https://behave.readthedocs.io/en/stable/" target="_blank"
                        rel="noopener noreferrer">behave</a></strong></span> вообще волшебная штука для интеграционных тестов. И не надо уточнять детали запроса. Все есть в тесте. Особенно с выводом результатов в формате allure. Отдельный репозиторий для тестов, доступный всем разработчикам. </span>
    </strong></p>
<p><span style="font-weight: 400;"> <img class="pull-center" src="images/allure5.png"
                                         alt=""/></span></p>
<p><span style="font-weight: 400;"> <img class="pull-center" src="images/allure6.png"
                                         alt=""/></span></p>
<p>Результат отработки тестовых скриптов behave.</p>
<p><span style="font-weight: 400;"> <span style="font-weight: 400;"> <strong> <span
                    style="font-weight: 400;"><br/></span> <span style="font-weight: 400;">В конце концов, скрипты <strong> <span
                            style="text-decoration: underline; color: #3366ff;"> <a
                                style="text-decoration: underline; color: #3366ff;"
                                href="https://httpie.io/" target="_blank" rel="noopener noreferrer">httpie</a> </span> </strong>. И не нужно мучаться через web интерфейс с ручным вводом. Бек-эндеры могут помочь тестировщикам в этом деле. Что бывает <span
                        style="text-decoration: underline;">психологически(?) </span> сложно принять для тестировщиков. "Я тут через браузер все руками попробовал и я уверен, а ты мне какую-то левую утилиту подсовываешь".
                </span>
                <br/>
                </strong>
            <span
                style="font-weight: 400;"> Для нагрузочных испытаний, есть классная утилита
                <span style="text-decoration: underline; color: #3366ff;">
                    <strong> <a
                            style="text-decoration: underline; color: #3366ff;" title="yandex-tank"
                            href="https://github.com/yandex/yandex-tank" target="_blank"
                            rel="noopener noreferrer">yandex-tank. </a> <a
                            style="text-decoration: underline; color: #3366ff;" title="yandex-tank"
                            href="https://github.com/cherepakhin/lot4/blob/master/doc/load.md"
                            target="_blank" rel="noopener noreferrer">(Пример).</a>
                    </strong>
                </span>
            </span>
        </span>
    </span>
</p>
<p><span style="font-weight: 400;">Для создания отчетов покрытия тестами использовал jacoco.</span>
</p>
<h3><b>Документация.</b></h3>
<p><span style="font-weight: 400;">Для создания документации для разработчика использовал OpenApi, Swagger. Ну и rest по быстрому проверить можно. Столкнулся с требованием заказчика не использовать Swagger.</span>
</p>
<h3><b>Многопоточка.</b></h3>
<p><span
        style="font-weight: 400;">Игнорируется возможности Springa при многопоточности. </span><span
        style="font-weight: 400;">Бесконтрольное (а чаще бессмысленное) использование многопоточки. Все начинается с Promise в ответе метода. </span><span
        style="font-weight: 400;">Promise расползается везде, как короновирус =&gt; сложное программирование на promis-ах, сложное тестирование. Вообще 300 раз надо подумать, перед тем как возвращать Promise. (Да-да! Я не умею его готовить. Ок. А заодно вспомните что же такое RestController и Spring вообще?). Для себя использую такое правило: где породил Promise, тут же его и разруливай, если уж без него никак, и желательно через private. т.к. это локальное решение и не надо ради него усложнять остальной код, опять же вспоминаем что такое Spring. <br/></span>
</p>
<h3>Бумажка</h3>
<p>Реально зашли такие графические средства как <span style="text-decoration: underline;"> <span
            style="color: #3366ff;"><strong><a style="color: #3366ff; text-decoration: underline;"
                                               title="Пример" href="https://miro.com/"
                                               target="_blank"
                                               rel="noopener noreferrer">miro.com</a></strong> </span> </span>,
    <span style="text-decoration: underline;"> <span style="color: #3366ff;"> <strong> <a
                    style="color: #3366ff; text-decoration: underline;"
                    href="https://app.diagrams.net/" target="_blank" rel="noopener noreferrer">diagrams.net </a> </strong> </span> </span>.
    Именно как инструмент <strong>взаимодействия разработчиков и проектирования</strong>, а не как
    картинка или часть документации (да и документации тоже). Архитектурим прямо на доске, online.
    Аналитик (и не только он) видит вопросы и есть время "на подумать", уточнить. При следующем
    входе подсвечивается что изменилось.</p>
<p><span style="font-weight: 400;"> <img class="pull-center" src="images/miro3.png"
                                         alt=""/><br/> </span></p>
<h3>Выделение отдельного микросервиса</h3>
<p>Описать выделение отдельного микросервиса(причины, план ввода в работу, проблемы ввода)???. А
    точно надо тут? Масса лит-ры на эту тему.</p>
<h3>Марк, постреляем?</h3>
<p>Я о devops. Марк - это король devops-а, с которым мне повезло работать. "Постреляем" это про
    нагрузочные испытания <strong><a style="text-decoration: underline; color: #3366ff;"
                                     title="yandex-tank"
                                     href="https://github.com/yandex/yandex-tank" target="_blank"
                                     rel="noopener noreferrer">yandex-tank</a></strong>. Хотя я не
    только про них (испытания).</p>
<p>Иногда случается, что devops инженеры как-то за скобками команды. Вам повезло, если разработчики
    в контакте с devops инженером. С нормальным devops инженером есть о чем поговорить.</p>
<ul>
    <ul>
        <li>Он пришлет вам результаты тестирования и развертывания.</li>
        <li>Проведет нагрузочные испытания.</li>
        <li>Укажет чего вы там забыли чего-то задокументировать и понятно и логично отразит
            изменения в разных wiki системах (в которых часто каша).
        </li>
        <li>Вытащит условия возникновения ошибки на prode (хотя сами виноваты, когда отмахнулись в
            виде e.printStackTrace ()). От пользователей, в этом случае, чаще мало толку ("Я
            работала как обычно, нажала эту кнопочку и вдруг все пропало" или "Ничего не работает").
        </li>
        <li>Организует версионирование в понятной схеме.</li>
        <li>Покажет где и что не протестировано.</li>
        <li>Укажет на перерасход ресурсов. А то и поделится опытом, как оптимизировать (база,
            очереди, кеши).
        </li>
    </ul>
</ul>
<p>И много чего еще. В общем это источник порядка и подотрет вам сопельки.</p>
<h3>Новичок в команде</h3>
<p>Отдельно выделил! И это не про короновирус. Какой-то нечеловеческий снобизм и в то же время <b>безразличие(!)</b>
    к новому сотруднику. Вход в новый проект, в другую команду. Тут и подключение через vpn, и
    знакомство с ресурсами, и людьми, с самим проектом и т.п. Лениво так какую-то <b>левую</b>
    ссылочку кинут на jira(не на раздел проекта, а просто на корень jira), после 10-го обращения,
    если повезет то и на репозитории. Или тупо: посмотри в jira, к которой <b>нет доступа</b>, т.к.
    не дали vpn, и куда за ним бежать неизвестно. И за куратором приходится побегать.</p>
<p>Решение очень простое. В jira задача: "Довести нового сотрудника до 2-3 push в репу" (как-то
    неоднозначно звучит. В чью репу push? <img
        src="media/editors/tinymce/plugins/emoticons/img/smiley-laughing.gif" alt="laughing"/>).
    Срок - неделя или две. Объем пушей по самому минимуму, задачи выбирает куратор или даже
    специально создает. 2-3 задачи никак ни на что не влияют. Тут цель - освоиться, отмазки типа
    "новичок тупой" в топку.</p>
<h3>Команда</h3>
<p><a style="text-decoration: underline; color: #3366ff;" title="Идеальная команда"
      href="index.php/notes/29-idealnaya-komanda" target="_blank" rel="noopener noreferrer">Идеальная
        команда</a>. Не жалеть времени на общение бек-эндера с бек-эндером. Глаз замыливается. Даже
    <b>отдельный</b> дейлик для бек-эндеров, даже если их всего двое. Апрувим друг-друга. Вопросы
    для дейлика размещать прямо в коде в виде "todo?". Todo помогает переварить речь перед
    обсуждением (и не только автора todo). Кстати, лучше вечером. Решается еще не мелкая проблема -
    оторвать коллегу от компа, от кода. Иначе, будет сидеть до ночи. Выгорание это все-таки не
    буржуйские сопли.</p>
<h3>О! Женщины!</h3>
<p>Просто само присутствие в команде как-то дисциплинирует что-ли, автоматом включается "рыцарь",
    "мужик" (по разному включается). Базар фильтруется. Перед дейликом волосики причесываются,
    пузики втягиваются (Нет пузика? Hotfix срочно!), пуговички застегиваются. Накосячить ну никак
    нельзя. Опять же внимательность к мелочам, порядку, чистоплотность, терпеливость.</p>
<h3>Чего-то не хватает...</h3>
<p>Задачи проекта. Угу. Точнее, понять задачу заказчика. И в целом, и в частности. Сесть на его
    место и через аналитиков корректировать хотелки. Ванговать перспективу развития. Заказчик и сам
    мутно представляет, что же он в итоге хочет. Это нормально. Мы должны ему сказать, мы на это
    учились. Термин для этого есть - "автоматизация хаоса". Иногда можно сказать "Нет. Не так.",
    точнее, предложить варианты. Вплоть до изменения бизнес-процессов и функций конечных
    пользователей. Вполне, реально.</p>
<h3>Ну и все, вроде.</h3>
<p>Почему-то backend рулит(именно рулит!) и архитекторами, и тестировщиками, и фронтом, да и вообще
    развитием всего проекта. Как-то кривова-то, на мой взгляд.</p>
<p>Бек-эндеры обычно не склонны к болтливости, фильтруют базар, что иногда здорово мешает.</p>
<p><span style="font-weight: 400;"> Для кого я это все написал? Да для себя прежде всего, чтобы не забывать при смене работы. Мозги причесать.</span>
</p>
<p><span style="font-weight: 400;"> И да! Это все сеньерские заморочки, т.к. ведет в параллель 2-3 проекта. Является заложником решений, которые уже на проде. Типа "работает - не трогай". Некогда анализировать, некогда объяснять коллегам, некогда <span
            style="text-decoration: underline;">объяснять</span> <span
            style="text-decoration: underline;">каменты</span> , некогда поднимать уровень коллег. Короче - некогда, не просто лень. (Отмазался)<br/></span>
</p>
<p>Длинно получилось. Слишком длинно. Может ломануться и написать следующую версию "Горький вкус
    java"?</p>
<p><span style="font-weight: 400;">Как же сложно сделать просто<img
            src="media/editors/tinymce/plugins/emoticons/img/smiley-laughing.gif"
            alt="laughing"/></span></p>
<hr/>
<p><span style="font-weight: 400;"><strong style="font-weight: 400;"><b>PS</b></strong><br/> Еще бы не забыть:<br/><br/> Черкнуть пару слов в отдельной статье, подробно и с примерами, о бессмысленности использования, причин возникновения, сопровождения и ухода от такого <b>"чуда"</b> как karaf в микросервисе kubernetes. Модульный karaf в микросервисе. Мозг в трубочку. А че не кубер в bundle карафа, да чего там мелочиться, лучше сразу windows в bundle, в которые запущен docker <img
            src="media/editors/tinymce/plugins/emoticons/img/smiley-laughing.gif" alt="laughing"/>. Стоп! Stackoverflow. Короче, гнать karaf из микросервиса кубера. Накувыркался уже. Какая-то необъяснимая тяга к модульной java. Я и сам болел этим делом. Использование maven-зависимостей или отдельного микросервиса гораздо жестче и надежнее решает эту задачу. Уже пара проектов за плечами по "убийству" karaf в kubernetes. Надо в резюме уже писать "Убиваю karaf в кубере. Дорого." Как же легче становится писать. <br/><br/>Перечитал утром. Ну, я крут! <br/> <br/> Отдельная тема <b>восстановление после перерыва</b>. Отпуска, болезни. Короткий рецепт: писать код. Свои мелкие проекты от rest до базы, но писать.<br/> <br/> </span>
</p>
