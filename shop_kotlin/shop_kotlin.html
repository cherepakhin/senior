<h3 dir="auto" tabindex="-1">Оглавление:</h3>
<p dir="auto"><a href="#target_project">Цель</a></p>
<p dir="auto">
    <a href="#static_analize">Статический анализатор Idea Analize</a><br />
    <a href="#sonarcube">Статический анализатор SonarCube</a><br />
    <a href="#jpa_kotlin">JPA Entity классы с Kotlin</a>
</p>
<p dir="auto">
    <a href="#unit_test">Unit тестирование</a><br />
    <a href="#integration_test">Интеграционное тестирование в проекте</a><br />
    <a href="#coverage_test">Покрытие тестами</a><br />
    <a href="#spring_profiles">Spring profiles</a><br />
    <a href="#test_run">Тестовый запуск</a>
</p>
<p dir="auto">
    <a href="#bootjar">Создание запускаемого файла и его запуск</a><br />
    <a href="#publish_fat-jar">Publishing SpringBoot "FAT" jar</a>
</p>
<p dir="auto">
    <a href="#datajpa_restassured_test">Интеграционное тестирование</a><br />
    <a href="#httpie">Примеры тестов httpie</a><br />
    <a href="#datajpa_test">DataJpa tests</a><br />
    <a href="#restassured">RestAssured tests</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin_yandex_tank_test">Нагрузочное тестирование</a>
</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin#swagger">Swagger</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#spring_actuator">Spring Actuator</a>
</p>
<p dir="auto">
    <a href="https://github.com/cherepakhin/shop_kotlin#prometheus">Prometheus</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#show_cpu_prometheus">Пример просмотра использования CPU в Prometheus</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#prometheus_docker">Запуск prometheus в docker</a>
</p>
<p dir="auto">
    <a href="https://github.com/cherepakhin/shop_kotlin#docker">Docker</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#grafana">Grafana</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#cache">Кеширование</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#jenkins">Сборка Jenkins</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#nexus">Nexus</a>
</p>
<p dir="auto">
    <a href="https://github.com/cherepakhin/shop_kotlin#jmc">Просмотр ресурсов с помощью Java Mission Control</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#logging">Логирование</a>
</p>
<p dir="auto">
    <a href="https://github.com/cherepakhin/shop_kotlin#easycode_idea">Использование "ChatGPT-EasyCode" в Idea</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#easycode_vscode">Использование "ChatGPT-EasyCode" в VSCode</a>
</p>
<p dir="auto">
    <a href="https://github.com/cherepakhin/shop_kotlin#todo">TODO</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#tose">Примечания</a><br />
    <a href="https://github.com/cherepakhin/shop_kotlin#links">Ссылки</a>
</p>
<hr id="system-readmore"/>
<a id="target_project"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-цель" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%86%D0%B5%D0%BB%D1%8C"></a>Цель</h3>
    <p dir="auto">Cоздать небольшое приложение на <b>Kotlin</b> с использованием <b>Spring Boot</b>. Справочник товаров со следующими типами:</p>
    <ul dir="auto">
        <li>Настольные компьютеры</li>
        <li>Ноутбуки</li>
        <li>Мониторы</li>
        <li>Жесткие диски</li>
    </ul>
    <p>Каждый товар имеет следующие свойства:</p>
    <ul dir="auto">
        <li>номер серии</li>
        <li>производитель</li>
        <li>цена</li>
        <li>количество единиц продукции на складе</li>
    </ul>
    <p dir="auto">Дополнительные свойства:</p>
    <ul dir="auto">
        <li>Настольные компьютеры имеют форм-фактор: десктопы, неттопы, моноблоки</li>
        <li>Ноутбуки подразделяются по размеру: 13, 14, 15, 17 дюймовые</li>
        <li>Мониторы имеют диагональ</li>
        <li>Жесткие диски имеют объем</li>
    </ul>
<p>Необходимо реализовать back-end приложение, которое имеет RESTful HTTP методы выполняющие:</p>
<ul dir="auto">
    <li>Добавление товара</li>
    <li>Редактирование товара</li>
    <li>Просмотр всех существующих товаров по типу</li>
    <li>Просмотр товара по идентификатору</li>
</ul>
<p>В качестве базы данных использовать in memory database, например H2.</p>
<p dir="auto"> </p>
<a id="static_analize"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-статический-анализатор-idea-analize" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80-idea-analize"></a>Статический анализатор Idea Analize
</h3>
<p dir="auto">Проверка кода. Вызывается из контекстного меню Analize - Inspect Code.</p>
<p dir="auto"> </p>
<a id="sonarcube"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-статический-анализатор-sonarcube" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80-sonarcube"></a>Статический анализатор SonarCube
</h3>
<p dir="auto">
    <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/sonarqube/use_sonarcube.md">https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/sonarqube/use_sonarcube.md</a>
</p>
<p dir="auto"> </p>
<a id="jpa_kotlin"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-jpa-entity-классы-с-kotlin" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#jpa-entity-%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D1%8B-%D1%81-kotlin"></a>JPA Entity классы с Kotlin
</h3>
<p dir="auto">
    Источник: <a href="https://habr.com/ru/companies/haulmont/articles/572574/" rel="nofollow">https://habr.com/ru/companies/haulmont/articles/572574/</a><br />Примеры из источника: <a href="https://github.com/Klimenkoob/spring-kotlin-hibernate">https://github.com/Klimenkoob/spring-kotlin-hibernate</a>
</p>
<p dir="auto">Рекомендации:</p>
<ol dir="auto">
    <li><strong>Data class not recommended for JPA Entity</strong> . Warning in Idea. Почему не использовать Data-классы? Потому что они финальны сами по себе, имеют по всем полям определенные equals, hashCode и toString. А это недопустимо в связке с Hibernate.</li>
    <li>Явно помечать ключевым словом <strong>open</strong> все Entity. Согласно спецификации JPA, все классы и свойства, связанные с JPA, не должны быть <strong>final</strong>. В отличие от Java, в Kotlin классы, свойства и методы по умолчанию final. Поэтому их нужно явно помечать ключевым словом <strong>open</strong>.</li>
    <li><strong>Явно определять</strong> hashCode(), equals(), toString(). При определении внимание на <strong>lazy</strong> поля (как и в Java).</li>
    <li>Добавить <strong>nullable = false</strong></li>
</ol>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre>   @ManyToOne(fetch <span class="pl-k">=</span> <span class="pl-en">FetchType</span>.<span class="pl-en">LAZY</span>, optional <span class="pl-k">=</span> <span class="pl-c1">false</span>)
   @JoinColumn(name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>client_id<span class="pl-pds">"</span></span>, nullable <span class="pl-k">=</span> <span class="pl-c1">false</span>)
   <span class="pl-k">lateinit</span> <span class="pl-k">var</span> client<span class="pl-k">:</span> <span class="pl-en">Client</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<ol dir="auto" start="5">
    <li>Kotlin классы по умолчанию <strong>final</strong>. Для Entity это проблема. Можно применить plugin "allopen":</li>
</ol>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre>plugins {
  kotlin(<span class="pl-s"><span class="pl-pds">"</span>plugin.allopen<span class="pl-pds">"</span></span>)
}
<span class="pl-k">..</span>.

allopen {
  annotation(<span class="pl-s"><span class="pl-pds">"</span>javax.persistence.Entity<span class="pl-pds">"</span></span>)
}
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<a id="unit_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-unit-тестирование" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#unit-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"></a>Unit тестирование
</h3>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>./gradlew <span class="pl-c1">test</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Примеры отбора тестов:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>./gradlew <span class="pl-c1">test</span> --tests <span class="pl-s"><span class="pl-pds">'</span>*EntityTest<span class="pl-pds">'</span></span>
./gradlew <span class="pl-c1">test</span> --tests <span class="pl-s"><span class="pl-pds">'</span>*Rest*<span class="pl-pds">'</span></span>
./gradlew <span class="pl-c1">test</span> --tests ProductDTOTest
./gradlew <span class="pl-c1">test</span> --tests <span class="pl-s"><span class="pl-pds">'</span>*TestIntegration<span class="pl-pds">'</span></span>
./gradlew <span class="pl-c1">test</span> --tests <span class="pl-s"><span class="pl-pds">'</span>*MockMvcTest<span class="pl-pds">'</span></span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<a id="integration_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-интеграционное-тестирование-в-проекте" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B2-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B5"></a>Интеграционное тестирование в проекте
</h3>
<p dir="auto">Вообще, интеграционные тесты должны быть в отдельном проекте (см. <a href="https://github.com/cherepakhin/shop_kotlin_restassured_test">https://github.com/cherepakhin/shop_kotlin_restassured_test</a>). В этом проекте оставил только тесты работы с базой данных. Имена интеграционных тестов должны заканчиваться ..TestIntegration. Прогнать все, кроме интеграционных (включены только *Test, исключены *TestIntegration):</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>./gradlew clean <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>Test
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Только интеграционные:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>./gradlew clean <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>TestIntegration<span class="pl-k">*</span>
./gradlew clean <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>TestIntegration</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Другие примеры:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>gradle <span class="pl-c1">test</span> --tests org.gradle.SomeTest.someSpecificFeature
gradle <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>SomeTest.someSpecificFeature
gradle <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>SomeSpecificTest
gradle <span class="pl-c1">test</span> --tests all.in.specific.package<span class="pl-k">*</span>
gradle <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>IntegTest
gradle <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>IntegTest<span class="pl-k">*</span>ui<span class="pl-k">*</span>
gradle <span class="pl-c1">test</span> --tests <span class="pl-k">*</span>IntegTest.singleMethod
gradle someTestTask --tests <span class="pl-k">*</span>UiTest someOtherTestTask --tests <span class="pl-k">*</span>WebTest<span class="pl-k">*</span>ui</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Включено протоколирование тестов build.gradle.kts:</p>
<div class="highlight highlight-text-xml notranslate position-relative overflow-auto" dir="auto">
<pre>...
tasks.withType&lt;<span class="pl-ent">Test</span>&gt; {
    ...
    // Show test log
    testLogging {
        events("passed", "skipped", "failed")
    }
    ...
}</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Вывод в консоль:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate" lang="text"><code>...
ProductServiceImplMockTest &gt; getByGroupProductN() PASSED
ProductServiceIntegrationTest &gt; existByN() PASSED
ProductServiceIntegrationTest &gt; notExistByN() PASSED
ProductServiceIntegrationTest &gt; checkSortByName_ByDslFilterByName() PASSED
...
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">с events("standardOut", "started", "passed", "skipped", "failed") логируется вывод в консоль.</p>
<p dir="auto"> </p>
<a id="coverage_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-покрытие-тестами" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D0%BE%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B0%D0%BC%D0%B8"></a>Покрытие тестами
</h3>
<p dir="auto">Использован <a href="https://www.eclemma.org/jacoco/" rel="nofollow">jacoco</a>. Отчет формируется при прогоне тестов</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>./gradlew <span class="pl-c1">test</span> jacocoTestReport</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Отчет будет в папке build/reports/jacoco/test/html. В отчете <strong>НЕТ</strong> информации о результатах тестирования, только протестирован участок кода или нет.</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jacoco.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jacoco.png" alt="jacoco" /></a></p>
<p dir="auto">Пример отчета по конкретному классу:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jacoco_example.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jacoco_example.png" alt="jacoco_example" /></a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jacoco_class.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jacoco_class.png" alt="jacoco_class" /></a></p>
<p dir="auto">Красным или желтым выделены непротестированные участки кода, зеленым протестировано.</p>
<p dir="auto"> </p>
<a id="spring_profiles"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-spring-profiles" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#spring-profiles"></a>Spring profiles
</h3>
<p dir="auto">Настроены два Spring профиля:
    <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/src/main/resources/application-prod.yml" target="_blank" rel="noopener noreferrer"><u>application-prod.yml</u></a>
         и
    <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/src/main/resources/application-dev.yml" target="_blank" rel="noopener noreferrer"><u>application-dev.yml</u></a>
    В этом же файле указан профиль по умолчанию:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-ent">spring</span>:
  <span class="pl-ent">profiles</span>:
    <span class="pl-ent">active</span>: <span class="pl-s">dev</span>
  <span class="pl-ent">application</span>:
    <span class="pl-ent">name</span>: <span class="pl-s">shop_kotlin</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Запуск с указанием профиля:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>java -D<span class="pl-s"><span class="pl-pds">"</span>spring.profiles.active=dev<span class="pl-pds">"</span></span> -jar app.jar</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">или установить env переменную:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>SPRING_PROFILES_ACTIVE = dev</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Запуск с gradle:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>$ ./gradlew bootRun --args=<span class="pl-s"><span class="pl-pds">'</span>--spring.profiles.active=dev<span class="pl-pds">'</span></span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">или</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>SPRING_PROFILES_ACTIVE=dev ./gradlew clean bootRun</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>

<a id="test_run"></a>
<h3>Тестовый запуск</h3>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>./gradlew bootRun</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<a id="bootjar"></a>
<h3 dir="auto">Создание запускаемого файла и его запуск</h3>
<p dir="auto">Создание:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>./gradlew bootJar</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">(<strong>bootJar</strong> не <strong>bootRun!!!</strong>)</p>
<p dir="auto">Собранный файл будет в папке <strong>./build/libs/</strong></p>
<p dir="auto">запуск с RAM 256Мб:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>shop_kotlin/$ java -Xmx256M -jar build/libs/shop_kotlin-0.1.20.jar</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">или так:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-c1">cd</span> shop_kotlin/build/libs
shop_kotlin/build/libs$ java -Xmx256M -jar shop_kotlin-0.1.20.jar</pre>
    <div class="zeroclipboard-container"> </div>
</div>

<p dir="auto"> </p>
<a id="publish_fat-jar"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-publishing-springboot-fat-jar" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#publishing-springboot-fat-jar"></a>Publishing SpringBoot "FAT" jar</h3>
<p dir="auto">Настройка:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-s">publishing {</span>
  <span class="pl-s">repositories {</span>
      <span class="pl-s">maven {</span>
          <span class="pl-s">url = uri("http://v.perm.ru:8082/repository/ru.perm.v/")</span>
          <span class="pl-s">isAllowInsecureProtocol = true</span>
          <span class="pl-s">//  for publish to nexus "./gradlew publish"</span>
          <span class="pl-s">// export NEXUS_CRED_USR=admin</span>
          <span class="pl-s">// echo $NEXUS_CRED_USR</span>
          <span class="pl-s">credentials {</span>
              <span class="pl-s">username = System.getenv("NEXUS_CRED_USR")</span>
              <span class="pl-s">password = System.getenv("NEXUS_CRED_PSW")</span>
          <span class="pl-s">}</span>
      <span class="pl-s">}</span>
  <span class="pl-s">}</span>
  <span class="pl-s">publications {</span>
    <span class="pl-s">create&lt;MavenPublication&gt;("maven"){</span>
      <span class="pl-s">artifact(tasks["bootJar"]) // build and publish bootJar</span>
    <span class="pl-s">}</span>
<span class="pl-s">}</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="https://stackoverflow.com/questions/64062905/unable-to-publish-jar-to-gitlab-package-registry-with-gradle" rel="nofollow">https://stackoverflow.com/questions/64062905/unable-to-publish-jar-to-gitlab-package-registry-with-gradle</a></p>
<p dir="auto"> </p>

<a id="httpie"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-примеры-тестов-httpie" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B-%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2-httpie"></a>Примеры тестов <a href="https://httpie.io/" rel="nofollow">httpie</a>
</h3>
<p dir="auto">Echo запрос для простой проверки работоспособности (:8980/shop_kotlin/ базовый путь проекта):</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>http :8980/shop_kotlin/api/echo/aaa

HTTP/1.1 200
Connection: keep-alive
Content-Length: 3
Content-Type: text/plain<span class="pl-k">;</span>charset=UTF-8
Date: Thu, 15 Jun 2023 07:30:38 GMT
Keep-Alive: timeout=60

aaa </pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Поиск по имени Product:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>http :8980/shop_kotlin/api/group_product/find<span class="pl-k">?</span>name=<span class="pl-s"><span class="pl-pds">'</span>Comp<span class="pl-pds">'</span></span>

[
    {
        <span class="pl-s"><span class="pl-pds">"</span>haveChilds<span class="pl-pds">"</span></span>: true,
        <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: 2,
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Computers<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>parentId<span class="pl-pds">"</span></span>: 1
    },
    {
        <span class="pl-s"><span class="pl-pds">"</span>haveChilds<span class="pl-pds">"</span></span>: false,
        <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: 3,
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Desktop Computers<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>parentId<span class="pl-pds">"</span></span>: 2
    }</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">POST запрос на изменение Product:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>http POST :8980/shop_kotlin/api/product/ <span class="pl-k">&lt;</span> ./src/test/json_test/product.json</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>

<a id="datajpa_restassured_test"></a>
<h3 dir="auto" tabindex="-1">
    <a id="user-content-интеграционное-тестирование" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"></a>Интеграционное тестирование
</h3>
<a id="datajpa_test"></a>
<p dir="auto">Два варианта тестирования - cо Spring @DataJpaTest и через RestAssured (это bdd тестирование). Совершенно разные тесты, для совершенно разных целей. DataJpaTest на уровне БД, RestAssured - сквозное тестирование от rest до БД.</p>
<p dir="auto"> </p>
<h4 dir="auto" tabindex="-1">
    <a tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#datajpatest">DataJPA test</a>
</h4>
<p dir="auto">Тестируется работа с базой данных с использованием <a href="https://www.baeldung.com/kotlin/spring-boot-testing#1-test-repository-using-datajpatest" rel="nofollow">@DataJpaTest</a>.
    Находятся в пакете <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/src/test/kotlin/ru/perm/v/shopkotlin/datajpatest">https://github.com/cherepakhin/shop_kotlin/blob/dev/src/test/kotlin/ru/perm/v/shopkotlin/datajpatest</a>.</p>
<p dir="auto"> </p>
<h4 dir="auto" tabindex="-1">
    <a tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin_reastassured_test">RestAssured</a>
</h4>
<p dir="auto">Для этих тестов сделан отдельный проект <a href="https://github.com/cherepakhin/shop_kotlin_reastassured_test">https://github.com/cherepakhin/shop_kotlin_reastassured_test</a></p>
<p dir="auto">Результат тестов:</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" title="allure_result_test" src="images/shop_kotlin/allure_result_test.png"
        alt="allure_result_test" width="841" height="565"/></p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-docker" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#docker"></a>Docker</h3>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/Dockerfile">Dockerfile</a></p>
<p dir="auto">Работа с Docker:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-c"># create docker image</span>
$./docker_build.sh

<span class="pl-c"># run app</span>
$ docker run -p 8080:8980 shop_kotlin/app

$ docker ps
CONTAINER ID   IMAGE             COMMAND                CREATED          STATUS          PORTS                    NAMES
c70ef82f3a54   shop_kotlin/app   <span class="pl-s"><span class="pl-pds">"</span>java -jar /app.jar<span class="pl-pds">"</span></span>   43 seconds ago   Up 42 seconds   0.0.0.0:8080-<span class="pl-k">&gt;</span>8980/tcp   inspiring_germain

<span class="pl-c"># simple test</span>
$ http :8080/api/group_product/find<span class="pl-k">?</span>name=<span class="pl-s"><span class="pl-pds">'</span>Comp<span class="pl-pds">'</span></span>

$ docker ps -a
<span class="pl-c"># 2d1325e1222a   shop_kotlin:0.24.0105    "/cnb/process/web" ...</span>

<span class="pl-c"># stop docker app</span>
<span class="pl-smi">$docker</span> stop 2d1

<span class="pl-c"># rm container shop_kotlin 2d1325e1222a (id from docker ps -a)</span>
<span class="pl-smi">$docker</span> container rm 2d1

<span class="pl-c"># rm image</span>
<span class="pl-smi">$docker</span> image ls
shop_kotlin 0.24.0105   94560d28efb3   ...

$ docker image rm 945
Untagged: shop_kotlin:0.24.0105

<span class="pl-c"># clear ALL images</span>
<span class="pl-smi">$docker</span> image prune -a

<span class="pl-c"># clear all</span>
<span class="pl-smi">$docker</span> system prune -af</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<h4 dir="auto" tabindex="-1"><a id="user-content-или-средствами-gradle" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D0%BB%D0%B8-%D1%81%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B2%D0%B0%D0%BC%D0%B8-gradle"></a>ИЛИ средствами gradle:</h4>
<p dir="auto">Создание docker image:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>./gradlew bootBuildImage

...

    [creator]     Saving docker.io/library/shop_kotlin:0.1.18...
    [creator]     <span class="pl-k">***</span> Images (f80a4e623a3d):
    [creator]           docker.io/library/shop_kotlin:0.1.18
Successfully built image <span class="pl-s"><span class="pl-pds">'</span>docker.io/library/shop_kotlin:0.1.18<span class="pl-pds">'</span></span>
...
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">В файле META-INF/MANIFEST.MF указать Main-Class</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate" lang="text"><code>Main-Class: ru.perm.v.shopkotlin.ShopKotlinApplication
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Запуск docker image:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ docker run -p 8980:8980 -p 8988:8988  docker.io/library/shop_kotlin:0.1.18
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">(8980 - основной порт, 8988 - spring actuator)</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ docker container ls
CONTAINER ID   IMAGE                COMMAND              CREATED          STATUS          PORTS                    NAMES
6544af7b0adb   shop_kotlin:0.1.18   <span class="pl-s"><span class="pl-pds">"</span>/cnb/process/web<span class="pl-pds">"</span></span>   12 seconds ago   Up 11 seconds   0.0.0.0:8980-<span class="pl-k">&gt;</span>8980/tcp   brave_sutherland
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Проверка:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ http http://127.0.0.1:8980/shop_kotlin/api/echo/aaa

HTTP/1.1 200
Connection: keep-alive
Content-Length: 3
Content-Type: text/plain<span class="pl-k">;</span>charset=UTF-8
Date: Thu, 30 Nov 2023 15:36:25 GMT
Keep-Alive: timeout=60
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers

aaa
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-swagger" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#swagger"></a>Swagger</h3>
<p dir="auto">Swagger доступен по адресу <a href="http://127.0.0.1:8980/shop_kotlin/api/swagger-ui/" rel="nofollow">http://127.0.0.1:8980/shop_kotlin/api/swagger-ui/</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/swagger.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/swagger.png" alt="swagger" /></a></p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-spring-actuator" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#spring-actuator"></a>Spring Actuator</h3>
<p dir="auto">Spring Actuator предназначен для получения информации о работающем приложении - статус приложения (жив/нет), использовании памяти, cpu и т.п.. Поключен по адресу <a href="http://127.0.0.1:8988/shop_kotlin/api/actuator" rel="nofollow">http://127.0.0.1:8988/shop_kotlin/api/actuator</a></p>
<p dir="auto">порт указан в application.yaml:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-ent">management</span>:
  <span class="pl-s">...</span>
  <span class="pl-ent">server</span>:
    <span class="pl-ent">port</span>: <span class="pl-c1">8988</span>
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Использование из командной строки:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ http http://127.0.0.1:8988/shop_kotlin/api/actuator

{
    <span class="pl-s"><span class="pl-pds">"</span>_links<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>beans<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://127.0.0.1:8988/shop_kotlin/api/actuator/beans<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>templated<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
        },
        <span class="pl-s"><span class="pl-pds">"</span>caches<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://127.0.0.1:8988/shop_kotlin/api/actuator/caches<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>templated<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
        },
        <span class="pl-s"><span class="pl-pds">"</span>caches-cache<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://127.0.0.1:8988/shop_kotlin/api/actuator/caches/{cache}<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>templated<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>
        },
....</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/actuator.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/actuator.png" alt="actuator" /></a></p>
<p dir="auto">Пример "Сколько памяти используется?":</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ http http://127.0.0.1:8988/shop_kotlin/api/actuator/metrics/jvm.memory.used
....
<span class="pl-s"><span class="pl-pds">"</span>baseUnit<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>bytes<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>The amount of used memory<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>measurements<span class="pl-pds">"</span></span>: [
        {
            <span class="pl-s"><span class="pl-pds">"</span>statistic<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>VALUE<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>: 147665416.0
        }
    ],
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>jvm.memory.used<span class="pl-pds">"</span></span>
....</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Нагрузочные тесты показали следующие результаты: 64M - приложение выпадает с OutOfMemory 128M - тесты проходят</p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-prometheus" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#prometheus"></a>Prometheus</h3>
<p dir="auto">На моем сервере запущен Prometheus. Prometheus <strong>ОПРАШИВАЕТ</strong> приложение, согласно заданию (ниже yaml), и собирает метрики (metrics_path+targets). Пример задания для опроса в файле <a href="https://github.com/cherepakhin/shop_kotlin/doc/prometheus/prometheus.yml">doc/prometheus/prometheus.yml</a>. Содержимое <a href="https://github.com/cherepakhin/shop_kotlin/doc/prometheus/prometheus.yml">doc/prometheus/prometheus.yml</a> поместить в настройки prometheus. Пример задания:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-ent">scrape_configs</span>:
- <span class="pl-ent">job_name</span>: <span class="pl-s"><span class="pl-pds">'</span>spring boot scrape<span class="pl-pds">'</span></span>
  <span class="pl-ent">metrics_path</span>: <span class="pl-s"><span class="pl-pds">'</span>/shop_kotlin/api/actuator/prometheus<span class="pl-pds">'</span></span>
  <span class="pl-ent">scrape_interval</span>: <span class="pl-c1">5s</span>
  <span class="pl-ent">static_configs</span>:
    - <span class="pl-ent">targets</span>: <span class="pl-s">['192.168.1.20:8988']</span>
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Опрашивать '192.168.1.20:8988/shop_kotlin/api/actuator/prometheus' каждые 5 сек.</p>
<p dir="auto">Для просмотра получаемых prometheus-ом метрик можно выполнить:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>$ http http://127.0.0.1:8788/api/actuator/prometheus<span class="pl-k">**</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">(Использован <a href="https://httpie.io/" rel="nofollow">httpie</a>)</p>
<p dir="auto">Ответ:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code># HELP jvm_threads_daemon_threads The current number of live daemon threads
# TYPE jvm_threads_daemon_threads gauge
jvm_threads_daemon_threads 13.0
# HELP hikaricp_connections Total connections
...
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Подключение к Prometheus из браузера: <a href="http://192.168.1.20:9090/targets" rel="nofollow">http://192.168.1.20:9090/targets</a></p>
<p dir="auto"><a href="http://192.168.1.20:9090/graph" rel="nofollow">http://192.168.1.20:9090/graph</a></p>
<p dir="auto">Основной экран: 192.168.1.20 - адрес хоста с prometheus <a href="http://192.168.1.20:9090/targets" rel="nofollow">http://192.168.1.20:9090/targets</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/prometheus_1_20_9090.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/prometheus_1_20_9090.png" alt="Основной экран" /></a></p>
<p dir="auto">Меню: Status/Targets <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/prometheus_status_targets.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/prometheus_status_targets.png" alt="Статус" /></a></p>
<p dir="auto">Приложение остановлено:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/shop_kotlin_down.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/shop_kotlin_down.png" alt="Приложение остановлено" /></a></p>
<p dir="auto">Приложение запущено:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/shop_kotlin_up.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/shop_kotlin_up.png" alt="Приложение остановлено" /></a></p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-пример-просмотра-использования-cpu-в-prometheus" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80-%D0%BF%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%D0%B0-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-cpu-%D0%B2-prometheus"></a>Пример просмотра использования CPU в Prometheus:</h3>
<p dir="auto">Prometheus запущен на 192.168.1.20:9090</p>
<p dir="auto">Перейти на <a href="http://192.168.1.20:9090/" rel="nofollow">http://192.168.1.20:9090</a> В меню "Graph":</p>
<ol dir="auto">
    <li>В "Expression" ввести system_cpu_usage</li>
    <li>Перейти на Graph</li>
    <li>Отрегулировать период (н.п. 15 мин.)</li>
</ol>
<p dir="auto">Итоговый запрос: <a href="http://192.168.1.20:9090/graph?g0.range_input=15m&amp;g0.expr=system_cpu_usage&amp;g0.tab=0" rel="nofollow">http://192.168.1.20:9090/graph?g0.range_input=15m&amp;g0.expr=system_cpu_usage&amp;g0.tab=0</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/prometheus/prometheus_system_cpu_usage.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/prometheus/prometheus_system_cpu_usage.png" alt="prometheus_system_cpu_usage" /></a></p>
<p dir="auto"> </p>
<h4 dir="auto" tabindex="-1"><a id="user-content-запуск-prometheus-в-docker" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-prometheus-%D0%B2-docker"></a>Запуск prometheus в docker:</h4>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>docker run -d -p 9090:9090 -v <span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">$(</span>pwd<span class="pl-pds">)</span>/for_prometheus/prometheus.yml<span class="pl-pds">"</span></span>:/etc/prometheus/prometheus.yml prom/prometheus</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Просмотр состояния prometheus, запущенного в docker:</p>
<p dir="auto">Вычисление ID container</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">&gt;</span>docker ps
CONTAINER ID   IMAGE             COMMAND                  CREATED         STATUS         PORTS                    NAMES
e081bb1f500c   prom/prometheus   <span class="pl-s"><span class="pl-pds">"</span>/bin/prometheus --c…<span class="pl-pds">"</span></span>   4 minutes ago   Up 4 minutes   0.0.0.0:9090-<span class="pl-k">&gt;</span>9090/tcp   reverent_newton</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Просмотр логов контейнера prometheus (e08 id контейнера)</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>docker logs e08 --follow</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Выхлоп:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code>...
ts=2023-09-11T13:13:17.850Z caller=main.go:1009 level=info msg="Server is ready to receive web requests."
ts=2023-09-11T13:13:17.850Z caller=manager.go:1009 level=info component="rule manager" msg="Starting rule manager..."
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-grafana" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#grafana"></a>Grafana</h3>
<p dir="auto">Graphana отображает метрики, собранные Prometheus. На домашнем сервере развернута Grafana:</p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/grafana.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/grafana.png" alt="grafana" /></a></p>
<p dir="auto">Запуск grafana:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>vasi@v$ sudo service grafana-server start</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Остановка grafana:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>vasi@v$ sudo service grafana-server stop</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="http://192.168.1.20:3000/explore?orgId=1&amp;left=%7B%22datasource%22:%22grafana%22,%22queries%22:%5B%7B%22queryType%22:%22randomWalk%22,%22refId%22:%22A%22,%22datasource%22:%7B%22type%22:%22datasource%22,%22uid%22:%22grafana%22%7D%7D%5D,%22range%22:%7B%22from%22:%22now-6h%22,%22to%22:%22now%22%7D%7D" rel="nofollow">Пример запроса</a></p>
<p dir="auto">user(pass): admin/admin</p>
<p dir="auto">Подробнее о нагрузочном тестировании и метриках в этом проекте <a href="https://github.com/cherepakhin/shop_kotlin_yandex_tank_test">https://github.com/cherepakhin/shop_kotlin_yandex_tank_test</a></p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-swagger-1" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#swagger-1"></a>Swagger</h3>
<p dir="auto">Адрес <a href="http://127.0.0.1:8980/shop_kotlin/api/swagger-ui/" rel="nofollow">http://127.0.0.1:8980/shop_kotlin/api/swagger-ui/</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/swagger.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/swagger.png" alt="swagger" /></a></p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-кеширование" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BA%D0%B5%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"></a>Кеширование</h3>
<p dir="auto">Кеширование сделано для RestController:</p>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre>@GetMapping(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>)
@Cacheable(<span class="pl-s"><span class="pl-pds">"</span>allGroupProductDTO<span class="pl-pds">"</span></span>)
@ApiOperation(<span class="pl-s"><span class="pl-pds">"</span>Get all groups of product<span class="pl-pds">"</span></span>)
<span class="pl-k">fun</span> <span class="pl-en">all</span>(): <span class="pl-c1">List</span>&lt;<span class="pl-en">GroupProductDTO</span>&gt; {
    <span class="pl-k">..</span>.
}</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Использован <a href="https://spring-projects.ru/guides/caching/" rel="nofollow">org.springframework.cache</a>. Ручная проверка работы кеш:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-c"># Очистка кеша</span>
<span class="pl-smi">$http</span> :8780/api/group_product/clear_cache
<span class="pl-c"># Для проверки, несколько раз сделать get запрос. </span>
<span class="pl-c"># При этом в лог будет только один запрос к репозиторию.</span>
<span class="pl-smi">$http</span> :8780/api/group_product/
</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-сборка-jenkins" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B0-jenkins"></a>Сборка Jenkins</h3>
<p dir="auto">Сборка происходит в Jenkins, развернутом на домашнем сервере. Pipeline для Jenkins описан в файле <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/Jenkinsfile">./Jenkinsfile</a></p>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jenkins_build_4_step.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jenkins_build_4_step.png" alt="jenkins" /></a></p>
<blockquote>
    <p dir="auto">Установка и настройка домашнего Jenkins описана в <a href="index.php/50-organizatsiya-sobstvennogo-ci-cd" rel="nofollow">http://v.perm.ru/main/index.php/50-organizatsiya-sobstvennogo-ci-cd</a></p>
</blockquote>
<p dir="auto">Для ограничения памяти при сборке Gradle, добавлен параметр в gradle.properties:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>org.gradle.jvmargs=-Xmx512M</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">В проекте используется внешняя зависимость из домашнего NEXUS репозитория <a href="https://github.com/cherepakhin/shop_kotlin_extdto">https://github.com/cherepakhin/shop_kotlin_extdto</a>:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>implementation(<span class="pl-s"><span class="pl-pds">"</span>ru.perm.v:shop_kotlin_extdto:0.0.3<span class="pl-pds">"</span></span>)</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-deploy-to-nexus-repository" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#deploy-to-nexus-repository"></a>Deploy to NEXUS repository</h3>
<p dir="auto">Возможен с использованием Jenkins (описано выше) или ручной deploy в Nexus с личного компьютера.</p>
<p dir="auto">Для deploy выполнить:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>./gradlew publish</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Путь к репозиторию установлен в build.gradle.kts:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>url = uri(<span class="pl-s"><span class="pl-pds">"</span>http://v.perm.ru:8082/repository/ru.perm.v/<span class="pl-pds">"</span></span>)</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Для установки переменных доступа к Nexus repository выполнить в shell:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>$ <span class="pl-k">export</span> NEXUS_CRED_USR=admin
$ <span class="pl-k">export</span> NEXUS_CRED_PSW=pass</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/nexus.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/nexus.png" alt="nexus" /></a></p>
<p dir="auto">Секция publishing в build.gradle.kts:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
<pre>publishing {
    repositories {
        maven {
            url = uri(<span class="pl-s"><span class="pl-pds">"</span>http://v.perm.ru:8082/repository/ru.perm.v/<span class="pl-pds">"</span></span>)
            isAllowInsecureProtocol = <span class="pl-c1">true</span>
            //  publish в nexus <span class="pl-s"><span class="pl-pds">"</span>./gradlew publish<span class="pl-pds">"</span></span> из ноута и Jenkins проходит
            // <span class="pl-k">export</span> NEXUS_CRED_USR=admin
            // <span class="pl-c1">echo</span> <span class="pl-smi">$NEXUS_CRED_USR</span>
            credentials {
                username = System.getenv(<span class="pl-s"><span class="pl-pds">"</span>NEXUS_CRED_USR<span class="pl-pds">"</span></span>)
                password = System.getenv(<span class="pl-s"><span class="pl-pds">"</span>NEXUS_CRED_PSW<span class="pl-pds">"</span></span>)
            }
        }
    }
    publications {
        register(<span class="pl-s"><span class="pl-pds">"</span>mavenJava<span class="pl-pds">"</span></span>, MavenPublication::class) {
            groupId
            artifactId
            version
            from(components[<span class="pl-s"><span class="pl-pds">"</span>java<span class="pl-pds">"</span></span>])
        }</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-просмотр-ресурсов-с-помощью-java-mission-control" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80-%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2-%D1%81-%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E-java-mission-control"></a>Просмотр ресурсов с помощью Java Mission Control</h3>
<p dir="auto"><a href="https://www.oracle.com/cis/javase/jmc/" rel="nofollow">Java Mission Control</a></p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto">
    <pre>jmc-8.3.1_linux-x64/JDK Mission Control$ jmc</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/jmc_monitor.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/jmc_monitor.png" alt="jmc" /></a></p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-логирование" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"></a>Логирование</h3>
<p dir="auto">Настройка сделана в application.yaml:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-ent">logging</span>:
  <span class="pl-ent">level</span>:
    <span class="pl-ent">root</span>: <span class="pl-s">info</span>
  <span class="pl-ent">file</span>:
    <span class="pl-ent">path</span>: <span class="pl-s">log/</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-использование-chatgpt-easycode-в-idea" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-chatgpt-easycode-%D0%B2-idea"></a>Использование "ChatGPT-EasyCode" в Idea</h3>
<p dir="auto">Пример работы плагина <a href="https://plugins.jetbrains.com/plugin/20603-chatgpt--easycode" rel="nofollow">Idea EasyCode</a> для автодополнения кода : <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/chatgpt_easycode/easycode_demo_worked.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/chatgpt_easycode/easycode_demo_worked.png" alt="demo ChatGPT-EasyCode" /></a></p>
<p dir="auto">Серым выделена подсказка EasyCode. "TAB" - принять предложение.</p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-использование-chatgpt-easycode-в-vscode" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-chatgpt-easycode-%D0%B2-vscode"></a>Использование "ChatGPT-EasyCode" в VSCode</h3>
<p dir="auto">Генерация тестов <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/chatgpt_easycode/run_write_test_easycode.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/chatgpt_easycode/run_write_test_easycode.png" alt="Сгенерировать тесты ChatGPT-EasyCode" /></a></p>
<p dir="auto">Рефакторинг <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/chatgpt_easycode/run_refactor_easycode.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/chatgpt_easycode/run_refactor_easycode.png" alt="Рефакторинг ChatGPT-EasyCode" /></a></p>
<p dir="auto"><strong>Вещь!</strong></p>
<p dir="auto">А отечественный GigaCode, в течении нескольких недель, отвечает унылым <a href="https://github.com/cherepakhin/shop_kotlin/blob/dev/doc/gigacode.png" target="_blank" rel="noopener noreferrer"><img src="https://github.com/cherepakhin/shop_kotlin/raw/dev/doc/gigacode.png" alt="" /></a></p>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-todo" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#todo"></a>TODO</h3>
<ul dir="auto">
    <li><del>cache on rest (сделано)</del></li>
    <li><del>RestAssured tests (сделано)</del> (<a href="https://github.com/cherepakhin/shop_kotlin_reastassured_test">https://github.com/cherepakhin/shop_kotlin_reastassured_test</a>)</li>
    <li><del>by lazy (сделано)</del></li>
    <li><del>Docker (сделано)</del></li>
    <li><del>Swagger (сделано)</del></li>
    <li><del>Actuator (сделано)</del></li>
    <li><del>flyway (использована БД в памяти url: jdbc:h2:mem:easybotdb). Миграции не требуются.</del></li>
    <li>webmvc тесты (ProductRestMockMvcTest)</li>
    <li><del>тесты service слоя с СУБД @DataJpaTest (сделано)</del></li>
    <li>вертикальные БД (?)</li>
    <li><del>Различные SQL запросы через native Sql и Spring JPA(order by, group by) (сделано)</del></li>
    <li>Pagination</li>
    <li><del>Grafana (сделано)</del></li>
    <li>ElasticSearch</li>
    <li>Авторизация</li>
</ul>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-примечания" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%87%D0%B0%D0%BD%D0%B8%D1%8F"></a>Примечания:</h3>
<p dir="auto">В программе не используются слои controller и service, т.к. проект сделан только для демонстрации Kotlin, и не планируется какая-либо бизнес-логика. Конвертация в DTO сделана в REST контроллерах.</p>
<p dir="auto">Поля в <strong>entity</strong> классах д.б. обозначены <strong>"open"</strong> (н.п. <strong>open</strong> val name: String = ""). В Kotlin используется следующий подход - можно наследовать от суперклассов и переопределять их свойства и функции только в том случае, если они снабжены префиксом <strong>"open"</strong>.</p>
<p dir="auto">Имя для "id" поля в entity классах названы "n". Причины:</p>
<ul dir="auto">
    <li>В некоторых БД "id" ключевое слово</li>
    <li>В interface repository есть отдельные методы repository.getById(), repository.findById(). Имеется ввиду поиск по primary key. Это путает.</li>
</ul>
<p dir="auto">Правила использования модификатора <strong>lateinit</strong>:</p>
<ul dir="auto">
    <li>используется только совместно с ключевым словом var;</li>
    <li>свойство может быть объявлено только внутри тела класса (не в основном конструкторе);</li>
    <li>тип свойства не может быть нулевым и примитивным;</li>
    <li>у свойства не должно быть пользовательских геттеров и сеттеров;</li>
    <li>с версии Kotlin 1.2 можно применять к свойствам верхнего уровня и локальным переменным.</li>
    <li>сообщает что инициализация будет как-то сделана (в примере ниже аннотациями @Mock, @InjectMocks). @Mock mockProductService будут инжектированы в @InjectMocks productRest. Пример:</li>
</ul>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">internal</span> <span class="pl-k">class</span> <span class="pl-en">ProductRestTest</span> {
    @Mock
    <span class="pl-k">private</span> <span class="pl-k">lateinit</span> <span class="pl-k">var</span> mockProductService<span class="pl-k">:</span> <span class="pl-en">ProductService</span>

    @InjectMocks
    <span class="pl-k">private</span> <span class="pl-k">lateinit</span> <span class="pl-k">var</span> productRest<span class="pl-k">:</span> <span class="pl-en">ProductRest</span>
    <span class="pl-k">..</span>.
}

</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><strong>byLazy</strong></p>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
    <pre><span class="pl-k">val</span> catName<span class="pl-k">:</span> <span class="pl-c1">String</span> by lazy { getName() }</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">свойство объявлено как <strong>VAL</strong>, но присвоение будет выполнено при <strong>первом использовании</strong> и потом уже не будет инициализироваться.</p>
<p dir="auto"><strong>Ссылки о lazy и lateinit:</strong></p>
<ul dir="auto">
    <li><a href="https://github.com/cherepakhin/kotlin_in_action">https://github.com/cherepakhin/kotlin_in_action</a></li>
    <li><a href="https://developer.alexanderklimov.ru/android/kotlin/lateinit.php" rel="nofollow">https://developer.alexanderklimov.ru/android/kotlin/lateinit.php</a></li>
    <li><a href="https://www.baeldung.com/kotlin/lazy-initialization" rel="nofollow">https://www.baeldung.com/kotlin/lazy-initialization</a></li>
    <li><a href="https://bimlibik.github.io/posts/kotlin-lateinit-and-lazy/" rel="nofollow">https://bimlibik.github.io/posts/kotlin-lateinit-and-lazy/</a></li>
</ul>
<p dir="auto"><strong>Статические члены и компаньон объекты в Kotlin:</strong></p>
<p dir="auto">Как правило объекты-компаньоны используются для объявления переменных и функций, к которым требуется обращаться без создания экземпляра класса. Либо для объявления констант. По сути они своего рода замена статическим членам класса (в отличие от Java, в Kotlin нет статики).</p>
<ul dir="auto">
    <li>Как бы static:</li>
</ul>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">class</span> <span class="pl-en">Someclass</span> {
  <span class="pl-k">..</span>.
  <span class="pl-k">object</span> AsStaticObject {
    <span class="pl-k">fun</span> <span class="pl-en">create</span>() {
      <span class="pl-k">..</span>.
    }
  }

}

<span class="pl-k">..</span>.

<span class="pl-k">val</span> someClass <span class="pl-k">=</span> <span class="pl-en">SomeClass</span>.<span class="pl-en">AsStaticObject</span>.create()</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<ul dir="auto">
    <li>Companion Object (вложенный объект. Метод create() принадлежит родительскому классу):</li>
</ul>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">class</span> <span class="pl-en">SomeClass</span> {

  <span class="pl-k">companion</span> <span class="pl-k">object</span> {
    <span class="pl-k">fun</span> <span class="pl-en">create</span>()
  }
}

<span class="pl-k">..</span>.

<span class="pl-k">val</span> someClass <span class="pl-k">=</span> <span class="pl-en">SomeClass</span>.create()</pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"><strong>Различия между val и const val в Kotlin</strong></p>
<div class="highlight highlight-source-kotlin notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-k">val</span> <span class="pl-en">MY_VAL</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>
<span class="pl-k">const</span> <span class="pl-k">val</span> <span class="pl-en">MY_CONST_VAL</span> <span class="pl-k">=</span> <span class="pl-c1">2</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<ul dir="auto">
    <li>Обе эти переменные немодифицируемые</li>
    <li><strong>MY_VAL</strong> станет приватной переменной, для доступа к которой будет создан геттер</li>
    <li><strong>MY_CONST_VAL</strong> будет заинлайнена, то есть компилятор заменит все полученные значения этой переменной на само значение</li>
    <li><a href="https://www.baeldung.com/kotlin/const-var-and-val-keywords" rel="nofollow">Kotlin const, var, and val Keywords</a></li>
</ul>
<p dir="auto"><strong>Ошибка "ERROR: Cannot resume build because FlowNode 19"</strong></p>
<p dir="auto">Ответ тут <a href="https://community.jenkins.io/t/error-cannot-resume-build-because-flownode-19/9477/3" rel="nofollow">https://community.jenkins.io/t/error-cannot-resume-build-because-flownode-19/9477/3</a></p>
<p dir="auto">В двух словах: добавить в Jenkinsfile "максмальную выживаемость"</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code>...
pipeline {

    agent any
    options {
        durabilityHint 'MAX_SURVIVABILITY'
    }
...
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<ul dir="auto">
    <li>
        <p dir="auto">В Windows на сетевом диске компилировалось с проблемами <strong>query-dsl</strong>. После переноса на <strong>диск C:</strong> проблемы ушли.</p>
    </li>
    <li>
        <p dir="auto">Если появилась ошибка: "./gradlew: строка 2: $'\r': команда не найдена", то выполнить:</p>
    </li>
</ul>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code>shop_kotlin$ gradle wrapper
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Похоже, при расшаривании папки для Windows и работе в Windows изменился символ конца строки.</p>
<ul dir="auto">
    <li>Смена версии gradlew: в ./gragle/wrapper/gradle-wrapper.properties</li>
</ul>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code>distributionUrl=https\://services.gradle.org/distributions/gradle-7.6.1-bin.zip
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto">Тесты проходят (из idea и из shell):</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto">
<pre class="notranslate"><code>./gradlew test
</code></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<ul dir="auto">
    <li>Jetty рекомендуют, как более оптимизированный контейнер. Л сделана так:</li>
</ul>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto">
<pre><span class="pl-s">dependencies {</span>
  <span class="pl-s">implementation("org.springframework.boot:spring-boot-starter-web") {</span>
    <span class="pl-s">exclude("org.springframework.boot:spring-boot-starter-tomcat")</span>
  <span class="pl-s">}</span>
  <span class="pl-s">implementation("org.springframework.boot:spring-boot-starter-jetty") // jetty uses less memory</span>
<span class="pl-s">}</span></pre>
    <div class="zeroclipboard-container"> </div>
</div>
<p dir="auto"> </p>
<h3 dir="auto" tabindex="-1"><a id="user-content-ссылки" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8"></a>Ссылки:</h3>
<p dir="auto"><a href="index.php/34-behave-testirovanie" rel="nofollow">Интеграционное тестирование REST</a><br /><a href="index.php/64-nastrojka-i-ispolzovanie-prometheus-grafana" rel="nofollow">Настройка и использование Prometheus, Grafana</a><br /><a href="index.php/homepage/56-shpargalka-po-docker" rel="nofollow">Шпаргалка по Docker</a><br /><a href="index.php/homepage/60-set-java-version" rel="nofollow">Set java version</a><br /><a href="index.php/50-organizatsiya-sobstvennogo-ci-cd" rel="nofollow">Установка и настройка домашнего Nexus/Jenkins</a></p>
<h4 dir="auto" tabindex="-1"><a id="user-content-todo-1" class="anchor" tabindex="-1" href="https://github.com/cherepakhin/shop_kotlin#todo-1"></a>TODO</h4>
<ul dir="auto">
    <li>Data class. <a href="https://kotlinlang.ru/docs/reference/data-classes.html" rel="nofollow">https://kotlinlang.ru/docs/reference/data-classes.html</a>.<br />Классы данных не могут быть абстрактными, open, sealed или inner. Компилятор автоматически формирует следующие члены данного класса из <strong>свойств</strong>, объявленных <strong>в основном конструкторе</strong>: equals()/hashCode(), toString() в форме "User(name=John, age=42)", компонентные функции componentN(), которые соответствуют свойствам, в соответствии с порядком их объявления. Основной конструктор должен иметь как минимум один параметр. Все параметры основного конструктора должны быть отмечены, как val или var.</li>
</ul>